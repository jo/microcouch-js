var Xn=Object.create;var _r=Object.defineProperty;var ea=Object.getOwnPropertyDescriptor;var ta=Object.getOwnPropertyNames;var ra=Object.getPrototypeOf,na=Object.prototype.hasOwnProperty;var aa=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var oa=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ta(t))!na.call(e,a)&&a!==r&&_r(e,a,{get:()=>t[a],enumerable:!(n=ea(t,a))||n.enumerable});return e};var ia=(e,t,r)=>(r=e!=null?Xn(ra(e)):{},oa(t||!e||!e.__esModule?_r(r,"default",{value:e,enumerable:!0}):r,e));var zn=aa((Fn,Ln)=>{(function(e){if(typeof Fn=="object")Ln.exports=e();else if(typeof define=="function"&&define.amd)define(e);else{var t;try{t=window}catch{t=self}t.SparkMD5=e()}})(function(e){"use strict";var t=function(h,c){return h+c&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(h,c,i,s,f,u){return c=t(t(c,h),t(s,u)),t(c<<f|c>>>32-f,i)}function a(h,c){var i=h[0],s=h[1],f=h[2],u=h[3];i+=(s&f|~s&u)+c[0]-680876936|0,i=(i<<7|i>>>25)+s|0,u+=(i&s|~i&f)+c[1]-389564586|0,u=(u<<12|u>>>20)+i|0,f+=(u&i|~u&s)+c[2]+606105819|0,f=(f<<17|f>>>15)+u|0,s+=(f&u|~f&i)+c[3]-1044525330|0,s=(s<<22|s>>>10)+f|0,i+=(s&f|~s&u)+c[4]-176418897|0,i=(i<<7|i>>>25)+s|0,u+=(i&s|~i&f)+c[5]+1200080426|0,u=(u<<12|u>>>20)+i|0,f+=(u&i|~u&s)+c[6]-1473231341|0,f=(f<<17|f>>>15)+u|0,s+=(f&u|~f&i)+c[7]-45705983|0,s=(s<<22|s>>>10)+f|0,i+=(s&f|~s&u)+c[8]+1770035416|0,i=(i<<7|i>>>25)+s|0,u+=(i&s|~i&f)+c[9]-1958414417|0,u=(u<<12|u>>>20)+i|0,f+=(u&i|~u&s)+c[10]-42063|0,f=(f<<17|f>>>15)+u|0,s+=(f&u|~f&i)+c[11]-1990404162|0,s=(s<<22|s>>>10)+f|0,i+=(s&f|~s&u)+c[12]+1804603682|0,i=(i<<7|i>>>25)+s|0,u+=(i&s|~i&f)+c[13]-40341101|0,u=(u<<12|u>>>20)+i|0,f+=(u&i|~u&s)+c[14]-1502002290|0,f=(f<<17|f>>>15)+u|0,s+=(f&u|~f&i)+c[15]+1236535329|0,s=(s<<22|s>>>10)+f|0,i+=(s&u|f&~u)+c[1]-165796510|0,i=(i<<5|i>>>27)+s|0,u+=(i&f|s&~f)+c[6]-1069501632|0,u=(u<<9|u>>>23)+i|0,f+=(u&s|i&~s)+c[11]+643717713|0,f=(f<<14|f>>>18)+u|0,s+=(f&i|u&~i)+c[0]-373897302|0,s=(s<<20|s>>>12)+f|0,i+=(s&u|f&~u)+c[5]-701558691|0,i=(i<<5|i>>>27)+s|0,u+=(i&f|s&~f)+c[10]+38016083|0,u=(u<<9|u>>>23)+i|0,f+=(u&s|i&~s)+c[15]-660478335|0,f=(f<<14|f>>>18)+u|0,s+=(f&i|u&~i)+c[4]-405537848|0,s=(s<<20|s>>>12)+f|0,i+=(s&u|f&~u)+c[9]+568446438|0,i=(i<<5|i>>>27)+s|0,u+=(i&f|s&~f)+c[14]-1019803690|0,u=(u<<9|u>>>23)+i|0,f+=(u&s|i&~s)+c[3]-187363961|0,f=(f<<14|f>>>18)+u|0,s+=(f&i|u&~i)+c[8]+1163531501|0,s=(s<<20|s>>>12)+f|0,i+=(s&u|f&~u)+c[13]-1444681467|0,i=(i<<5|i>>>27)+s|0,u+=(i&f|s&~f)+c[2]-51403784|0,u=(u<<9|u>>>23)+i|0,f+=(u&s|i&~s)+c[7]+1735328473|0,f=(f<<14|f>>>18)+u|0,s+=(f&i|u&~i)+c[12]-1926607734|0,s=(s<<20|s>>>12)+f|0,i+=(s^f^u)+c[5]-378558|0,i=(i<<4|i>>>28)+s|0,u+=(i^s^f)+c[8]-2022574463|0,u=(u<<11|u>>>21)+i|0,f+=(u^i^s)+c[11]+1839030562|0,f=(f<<16|f>>>16)+u|0,s+=(f^u^i)+c[14]-35309556|0,s=(s<<23|s>>>9)+f|0,i+=(s^f^u)+c[1]-1530992060|0,i=(i<<4|i>>>28)+s|0,u+=(i^s^f)+c[4]+1272893353|0,u=(u<<11|u>>>21)+i|0,f+=(u^i^s)+c[7]-155497632|0,f=(f<<16|f>>>16)+u|0,s+=(f^u^i)+c[10]-1094730640|0,s=(s<<23|s>>>9)+f|0,i+=(s^f^u)+c[13]+681279174|0,i=(i<<4|i>>>28)+s|0,u+=(i^s^f)+c[0]-358537222|0,u=(u<<11|u>>>21)+i|0,f+=(u^i^s)+c[3]-722521979|0,f=(f<<16|f>>>16)+u|0,s+=(f^u^i)+c[6]+76029189|0,s=(s<<23|s>>>9)+f|0,i+=(s^f^u)+c[9]-640364487|0,i=(i<<4|i>>>28)+s|0,u+=(i^s^f)+c[12]-421815835|0,u=(u<<11|u>>>21)+i|0,f+=(u^i^s)+c[15]+530742520|0,f=(f<<16|f>>>16)+u|0,s+=(f^u^i)+c[2]-995338651|0,s=(s<<23|s>>>9)+f|0,i+=(f^(s|~u))+c[0]-198630844|0,i=(i<<6|i>>>26)+s|0,u+=(s^(i|~f))+c[7]+1126891415|0,u=(u<<10|u>>>22)+i|0,f+=(i^(u|~s))+c[14]-1416354905|0,f=(f<<15|f>>>17)+u|0,s+=(u^(f|~i))+c[5]-57434055|0,s=(s<<21|s>>>11)+f|0,i+=(f^(s|~u))+c[12]+1700485571|0,i=(i<<6|i>>>26)+s|0,u+=(s^(i|~f))+c[3]-1894986606|0,u=(u<<10|u>>>22)+i|0,f+=(i^(u|~s))+c[10]-1051523|0,f=(f<<15|f>>>17)+u|0,s+=(u^(f|~i))+c[1]-2054922799|0,s=(s<<21|s>>>11)+f|0,i+=(f^(s|~u))+c[8]+1873313359|0,i=(i<<6|i>>>26)+s|0,u+=(s^(i|~f))+c[15]-30611744|0,u=(u<<10|u>>>22)+i|0,f+=(i^(u|~s))+c[6]-1560198380|0,f=(f<<15|f>>>17)+u|0,s+=(u^(f|~i))+c[13]+1309151649|0,s=(s<<21|s>>>11)+f|0,i+=(f^(s|~u))+c[4]-145523070|0,i=(i<<6|i>>>26)+s|0,u+=(s^(i|~f))+c[11]-1120210379|0,u=(u<<10|u>>>22)+i|0,f+=(i^(u|~s))+c[2]+718787259|0,f=(f<<15|f>>>17)+u|0,s+=(u^(f|~i))+c[9]-343485551|0,s=(s<<21|s>>>11)+f|0,h[0]=i+h[0]|0,h[1]=s+h[1]|0,h[2]=f+h[2]|0,h[3]=u+h[3]|0}function o(h){var c=[],i;for(i=0;i<64;i+=4)c[i>>2]=h.charCodeAt(i)+(h.charCodeAt(i+1)<<8)+(h.charCodeAt(i+2)<<16)+(h.charCodeAt(i+3)<<24);return c}function l(h){var c=[],i;for(i=0;i<64;i+=4)c[i>>2]=h[i]+(h[i+1]<<8)+(h[i+2]<<16)+(h[i+3]<<24);return c}function d(h){var c=h.length,i=[1732584193,-271733879,-1732584194,271733878],s,f,u,S,P,A;for(s=64;s<=c;s+=64)a(i,o(h.substring(s-64,s)));for(h=h.substring(s-64),f=h.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)u[s>>2]|=h.charCodeAt(s)<<(s%4<<3);if(u[s>>2]|=128<<(s%4<<3),s>55)for(a(i,u),s=0;s<16;s+=1)u[s]=0;return S=c*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),P=parseInt(S[2],16),A=parseInt(S[1],16)||0,u[14]=P,u[15]=A,a(i,u),i}function p(h){var c=h.length,i=[1732584193,-271733879,-1732584194,271733878],s,f,u,S,P,A;for(s=64;s<=c;s+=64)a(i,l(h.subarray(s-64,s)));for(h=s-64<c?h.subarray(s-64):new Uint8Array(0),f=h.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)u[s>>2]|=h[s]<<(s%4<<3);if(u[s>>2]|=128<<(s%4<<3),s>55)for(a(i,u),s=0;s<16;s+=1)u[s]=0;return S=c*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),P=parseInt(S[2],16),A=parseInt(S[1],16)||0,u[14]=P,u[15]=A,a(i,u),i}function b(h){var c="",i;for(i=0;i<4;i+=1)c+=r[h>>i*8+4&15]+r[h>>i*8&15];return c}function m(h){var c;for(c=0;c<h.length;c+=1)h[c]=b(h[c]);return h.join("")}m(d("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(t=function(h,c){var i=(h&65535)+(c&65535),s=(h>>16)+(c>>16)+(i>>16);return s<<16|i&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function h(c,i){return c=c|0||0,c<0?Math.max(c+i,0):Math.min(c,i)}ArrayBuffer.prototype.slice=function(c,i){var s=this.byteLength,f=h(c,s),u=s,S,P,A,O;return i!==e&&(u=h(i,s)),f>u?new ArrayBuffer(0):(S=u-f,P=new ArrayBuffer(S),A=new Uint8Array(P),O=new Uint8Array(this,f,S),A.set(O),P)}}();function v(h){return/[\u0080-\uFFFF]/.test(h)&&(h=unescape(encodeURIComponent(h))),h}function _(h,c){var i=h.length,s=new ArrayBuffer(i),f=new Uint8Array(s),u;for(u=0;u<i;u+=1)f[u]=h.charCodeAt(u);return c?f:s}function g(h){return String.fromCharCode.apply(null,new Uint8Array(h))}function E(h,c,i){var s=new Uint8Array(h.byteLength+c.byteLength);return s.set(new Uint8Array(h)),s.set(new Uint8Array(c),h.byteLength),i?s:s.buffer}function R(h){var c=[],i=h.length,s;for(s=0;s<i-1;s+=2)c.push(parseInt(h.substr(s,2),16));return String.fromCharCode.apply(String,c)}function w(){this.reset()}return w.prototype.append=function(h){return this.appendBinary(v(h)),this},w.prototype.appendBinary=function(h){this._buff+=h,this._length+=h.length;var c=this._buff.length,i;for(i=64;i<=c;i+=64)a(this._hash,o(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},w.prototype.end=function(h){var c=this._buff,i=c.length,s,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u;for(s=0;s<i;s+=1)f[s>>2]|=c.charCodeAt(s)<<(s%4<<3);return this._finish(f,i),u=m(this._hash),h&&(u=R(u)),this.reset(),u},w.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},w.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},w.prototype.setState=function(h){return this._buff=h.buff,this._length=h.length,this._hash=h.hash,this},w.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},w.prototype._finish=function(h,c){var i=c,s,f,u;if(h[i>>2]|=128<<(i%4<<3),i>55)for(a(this._hash,h),i=0;i<16;i+=1)h[i]=0;s=this._length*8,s=s.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(s[2],16),u=parseInt(s[1],16)||0,h[14]=f,h[15]=u,a(this._hash,h)},w.hash=function(h,c){return w.hashBinary(v(h),c)},w.hashBinary=function(h,c){var i=d(h),s=m(i);return c?R(s):s},w.ArrayBuffer=function(){this.reset()},w.ArrayBuffer.prototype.append=function(h){var c=E(this._buff.buffer,h,!0),i=c.length,s;for(this._length+=h.byteLength,s=64;s<=i;s+=64)a(this._hash,l(c.subarray(s-64,s)));return this._buff=s-64<i?new Uint8Array(c.buffer.slice(s-64)):new Uint8Array(0),this},w.ArrayBuffer.prototype.end=function(h){var c=this._buff,i=c.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f,u;for(f=0;f<i;f+=1)s[f>>2]|=c[f]<<(f%4<<3);return this._finish(s,i),u=m(this._hash),h&&(u=R(u)),this.reset(),u},w.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},w.ArrayBuffer.prototype.getState=function(){var h=w.prototype.getState.call(this);return h.buff=g(h.buff),h},w.ArrayBuffer.prototype.setState=function(h){return h.buff=_(h.buff,!0),w.prototype.setState.call(this,h)},w.ArrayBuffer.prototype.destroy=w.prototype.destroy,w.ArrayBuffer.prototype._finish=w.prototype._finish,w.ArrayBuffer.hash=function(h,c){var i=p(new Uint8Array(h)),s=m(i);return c?R(s):s},w})});var C=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:function(e){return"Symbol("+e+")"};function jt(){}function sa(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}var yr=sa();function B(e){return typeof e=="object"&&e!==null||typeof e=="function"}var zr=jt,It=Promise,ua=Promise.prototype.then,la=Promise.resolve.bind(It),fa=Promise.reject.bind(It);function W(e){return new It(e)}function T(e){return la(e)}function y(e){return fa(e)}function x(e,t,r){return ua.call(e,t,r)}function z(e,t,r){x(x(e,t,r),void 0,zr)}function wt(e,t){z(e,t)}function Ot(e,t){z(e,void 0,t)}function ne(e,t,r){return x(e,t,r)}function we(e){x(e,void 0,zr)}var Ye=function(){var e=yr&&yr.queueMicrotask;if(typeof e=="function")return e;var t=T(void 0);return function(r){return x(t,r)}}();function tt(e,t,r){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function ae(e,t,r){try{return T(tt(e,t,r))}catch(n){return y(n)}}var gr=16384,L=function(){function e(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.push=function(t){var r=this._back,n=r;r._elements.length===gr-1&&(n={_elements:[],_next:void 0}),r._elements.push(t),n!==r&&(this._back=n,r._next=n),++this._size},e.prototype.shift=function(){var t=this._front,r=t,n=this._cursor,a=n+1,o=t._elements,l=o[n];return a===gr&&(r=t._next,a=0),--this._size,this._cursor=a,t!==r&&(this._front=r),o[n]=void 0,l},e.prototype.forEach=function(t){for(var r=this._cursor,n=this._front,a=n._elements;(r!==a.length||n._next!==void 0)&&!(r===a.length&&(n=n._next,a=n._elements,r=0,a.length===0));)t(a[r]),++r},e.prototype.peek=function(){var t=this._front,r=this._cursor;return t._elements[r]},e}();function kr(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?Ft(e):t._state==="closed"?da(e):Mr(e,t._storedError)}function Dt(e,t){var r=e._ownerReadableStream;return F(r,t)}function $(e){e._ownerReadableStream._state==="readable"?Lt(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):ca(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function de(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function Ft(e){e._closedPromise=W(function(t,r){e._closedPromise_resolve=t,e._closedPromise_reject=r})}function Mr(e,t){Ft(e),Lt(e,t)}function da(e){Ft(e),Ur(e)}function Lt(e,t){e._closedPromise_reject!==void 0&&(we(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function ca(e,t){Mr(e,t)}function Ur(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}var xr=C("[[AbortSteps]]"),$r=C("[[ErrorSteps]]"),zt=C("[[CancelSteps]]"),kt=C("[[PullSteps]]"),Sr=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},ha=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function pa(e){return typeof e=="object"||typeof e=="function"}function Q(e,t){if(e!==void 0&&!pa(e))throw new TypeError(t+" is not an object.")}function k(e,t){if(typeof e!="function")throw new TypeError(t+" is not a function.")}function ba(e){return typeof e=="object"&&e!==null||typeof e=="function"}function Nr(e,t){if(!ba(e))throw new TypeError(t+" is not an object.")}function N(e,t,r){if(e===void 0)throw new TypeError("Parameter "+t+" is required in '"+r+"'.")}function At(e,t,r){if(e===void 0)throw new TypeError(t+" is required in '"+r+"'.")}function Mt(e){return Number(e)}function Qr(e){return e===0?0:e}function ma(e){return Qr(ha(e))}function Yr(e,t){var r=0,n=Number.MAX_SAFE_INTEGER,a=Number(e);if(a=Qr(a),!Sr(a))throw new TypeError(t+" is not a finite number");if(a=ma(a),a<r||a>n)throw new TypeError(t+" is outside the accepted range of "+r+" to "+n+", inclusive");return!Sr(a)||a===0?0:a}function Ut(e,t){if(!Y(e))throw new TypeError(t+" is not a ReadableStream.")}function ce(e){return new nt(e)}function Hr(e,t){e._reader._readRequests.push(t)}function xt(e,t,r){var n=e._reader,a=n._readRequests.shift();r?a._closeSteps():a._chunkSteps(t)}function rt(e){return e._reader._readRequests.length}function Vr(e){var t=e._reader;return!(t===void 0||!H(t))}var nt=function(){function e(t){if(N(t,1,"ReadableStreamDefaultReader"),Ut(t,"First parameter"),V(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");kr(this,t),this._readRequests=new L}return Object.defineProperty(e.prototype,"closed",{get:function(){return H(this)?this._closedPromise:y(Oe("closed"))},enumerable:!1,configurable:!0}),e.prototype.cancel=function(t){return t===void 0&&(t=void 0),H(this)?this._ownerReadableStream===void 0?y(de("cancel")):Dt(this,t):y(Oe("cancel"))},e.prototype.read=function(){if(!H(this))return y(Oe("read"));if(this._ownerReadableStream===void 0)return y(de("read from"));var t,r,n=W(function(o,l){t=o,r=l}),a={_chunkSteps:function(o){return t({value:o,done:!1})},_closeSteps:function(){return t({value:void 0,done:!0})},_errorSteps:function(o){return r(o)}};return Re(this,a),n},e.prototype.releaseLock=function(){if(!H(this))throw Oe("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");$(this)}},e}();Object.defineProperties(nt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(nt.prototype,C.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function H(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof nt}function Re(e,t){var r=e._ownerReadableStream;r._disturbed=!0,r._state==="closed"?t._closeSteps():r._state==="errored"?t._errorSteps(r._storedError):r._readableStreamController[kt](t)}function Oe(e){return new TypeError("ReadableStreamDefaultReader.prototype."+e+" can only be used on a ReadableStreamDefaultReader")}var Rt,He;typeof C.asyncIterator=="symbol"&&(He=(Rt={},Rt[C.asyncIterator]=function(){return this},Rt),Object.defineProperty(He,C.asyncIterator,{enumerable:!1}));var Gr=function(){function e(t,r){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=r}return e.prototype.next=function(){var t=this,r=function(){return t._nextSteps()};return this._ongoingPromise=this._ongoingPromise?ne(this._ongoingPromise,r,r):r(),this._ongoingPromise},e.prototype.return=function(t){var r=this,n=function(){return r._returnSteps(t)};return this._ongoingPromise?ne(this._ongoingPromise,n,n):n()},e.prototype._nextSteps=function(){var t=this;if(this._isFinished)return Promise.resolve({value:void 0,done:!0});var r=this._reader;if(r._ownerReadableStream===void 0)return y(de("iterate"));var n,a,o=W(function(d,p){n=d,a=p}),l={_chunkSteps:function(d){t._ongoingPromise=void 0,Ye(function(){return n({value:d,done:!1})})},_closeSteps:function(){t._ongoingPromise=void 0,t._isFinished=!0,$(r),n({value:void 0,done:!0})},_errorSteps:function(d){t._ongoingPromise=void 0,t._isFinished=!0,$(r),a(d)}};return Re(r,l),o},e.prototype._returnSteps=function(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;var r=this._reader;if(r._ownerReadableStream===void 0)return y(de("finish iterating"));if(!this._preventCancel){var n=Dt(r,t);return $(r),ne(n,function(){return{value:t,done:!0}})}return $(r),T({value:t,done:!0})},e}(),Jr={next:function(){return wr(this)?this._asyncIteratorImpl.next():y(Rr("next"))},return:function(e){return wr(this)?this._asyncIteratorImpl.return(e):y(Rr("return"))}};He!==void 0&&Object.setPrototypeOf(Jr,He);function va(e,t){var r=ce(e),n=new Gr(r,t),a=Object.create(Jr);return a._asyncIteratorImpl=n,a}function wr(e){if(!B(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof Gr}catch{return!1}}function Rr(e){return new TypeError("ReadableStreamAsyncIterator."+e+" can only be used on a ReadableSteamAsyncIterator")}var Kr=Number.isNaN||function(e){return e!==e};function _e(e){return e.slice()}function Zr(e,t,r,n,a){new Uint8Array(e).set(new Uint8Array(r,n,a),t)}function Ve(e){return!1}function Xr(e,t,r){if(e.slice)return e.slice(t,r);var n=r-t,a=new ArrayBuffer(n);return Zr(a,0,e,t,n),a}function _a(e){return!(typeof e!="number"||Kr(e)||e<0)}function Cr(e){var t=Xr(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function $t(e){var t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function Nt(e,t,r){if(!_a(r)||r===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function ya(e){var t=e._queue.peek();return t.value}function J(e){e._queue=new L,e._queueTotalSize=0}var at=function(){function e(){throw new TypeError("Illegal constructor")}return Object.defineProperty(e.prototype,"view",{get:function(){if(!Ct(this))throw Pt("view");return this._view},enumerable:!1,configurable:!0}),e.prototype.respond=function(t){if(!Ct(this))throw Pt("respond");if(N(t,1,"respond"),t=Yr(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");Ve(this._view.buffer),Ne(this._associatedReadableByteStreamController,t)},e.prototype.respondWithNewView=function(t){if(!Ct(this))throw Pt("respondWithNewView");if(N(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");Ve(t.buffer),Qe(this._associatedReadableByteStreamController,t)},e}();Object.defineProperties(at.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(at.prototype,C.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});var Ce=function(){function e(){throw new TypeError("Illegal constructor")}return Object.defineProperty(e.prototype,"byobRequest",{get:function(){if(!te(this))throw be("byobRequest");return qt(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!te(this))throw be("desiredSize");return un(this)},enumerable:!1,configurable:!0}),e.prototype.close=function(){if(!te(this))throw be("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");var t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError("The stream (in "+t+" state) is not in the readable state and cannot be closed");me(this)},e.prototype.enqueue=function(t){if(!te(this))throw be("enqueue");if(N(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");var r=this._controlledReadableByteStream._state;if(r!=="readable")throw new TypeError("The stream (in "+r+" state) is not in the readable state and cannot be enqueued to");$e(this,t)},e.prototype.error=function(t){if(t===void 0&&(t=void 0),!te(this))throw be("error");D(this,t)},e.prototype[zt]=function(t){en(this),J(this);var r=this._cancelAlgorithm(t);return it(this),r},e.prototype[kt]=function(t){var r=this._controlledReadableByteStream;if(this._queueTotalSize>0){var n=this._queue.shift();this._queueTotalSize-=n.byteLength,an(this);var a=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);t._chunkSteps(a);return}var o=this._autoAllocateChunkSize;if(o!==void 0){var l=void 0;try{l=new ArrayBuffer(o)}catch(p){t._errorSteps(p);return}var d={buffer:l,bufferByteLength:o,byteOffset:0,byteLength:o,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(d)}Hr(r,t),oe(this)},e}();Object.defineProperties(Ce.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(Ce.prototype,C.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function te(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof Ce}function Ct(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof at}function oe(e){var t=Ra(e);if(!!t){if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;var r=e._pullAlgorithm();z(r,function(){e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,oe(e))},function(n){D(e,n)})}}function en(e){Yt(e),e._pendingPullIntos=new L}function Qt(e,t){var r=!1;e._state==="closed"&&(r=!0);var n=tn(t);t.readerType==="default"?xt(e,n,r):Ta(e,n,r)}function tn(e){var t=e.bytesFilled,r=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/r)}function xe(e,t,r,n){e._queue.push({buffer:t,byteOffset:r,byteLength:n}),e._queueTotalSize+=n}function rn(e,t){var r=t.elementSize,n=t.bytesFilled-t.bytesFilled%r,a=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),o=t.bytesFilled+a,l=o-o%r,d=a,p=!1;l>n&&(d=l-t.bytesFilled,p=!0);for(var b=e._queue;d>0;){var m=b.peek(),v=Math.min(d,m.byteLength),_=t.byteOffset+t.bytesFilled;Zr(t.buffer,_,m.buffer,m.byteOffset,v),m.byteLength===v?b.shift():(m.byteOffset+=v,m.byteLength-=v),e._queueTotalSize-=v,nn(e,v,t),d-=v}return p}function nn(e,t,r){r.bytesFilled+=t}function an(e){e._queueTotalSize===0&&e._closeRequested?(it(e),Ee(e._controlledReadableByteStream)):oe(e)}function Yt(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function on(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;var t=e._pendingPullIntos.peek();rn(e,t)&&(ot(e),Qt(e._controlledReadableByteStream,t))}}function ga(e,t,r){var n=e._controlledReadableByteStream,a=1;t.constructor!==DataView&&(a=t.constructor.BYTES_PER_ELEMENT);var o=t.constructor,l=t.buffer,d={buffer:l,bufferByteLength:l.byteLength,byteOffset:t.byteOffset,byteLength:t.byteLength,bytesFilled:0,elementSize:a,viewConstructor:o,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(d),Pr(n,r);return}if(n._state==="closed"){var p=new o(d.buffer,d.byteOffset,0);r._closeSteps(p);return}if(e._queueTotalSize>0){if(rn(e,d)){var b=tn(d);an(e),r._chunkSteps(b);return}if(e._closeRequested){var m=new TypeError("Insufficient bytes to fill elements in the given buffer");D(e,m),r._errorSteps(m);return}}e._pendingPullIntos.push(d),Pr(n,r),oe(e)}function Sa(e,t){var r=e._controlledReadableByteStream;if(Ht(r))for(;dn(r)>0;){var n=ot(e);Qt(r,n)}}function wa(e,t,r){if(nn(e,t,r),!(r.bytesFilled<r.elementSize)){ot(e);var n=r.bytesFilled%r.elementSize;if(n>0){var a=r.byteOffset+r.bytesFilled,o=Xr(r.buffer,a-n,a);xe(e,o,0,o.byteLength)}r.bytesFilled-=n,Qt(e._controlledReadableByteStream,r),on(e)}}function sn(e,t){var r=e._pendingPullIntos.peek();Yt(e);var n=e._controlledReadableByteStream._state;n==="closed"?Sa(e):wa(e,t,r),oe(e)}function ot(e){var t=e._pendingPullIntos.shift();return t}function Ra(e){var t=e._controlledReadableByteStream;if(t._state!=="readable"||e._closeRequested||!e._started)return!1;if(Vr(t)&&rt(t)>0||Ht(t)&&dn(t)>0)return!0;var r=un(e);return r>0}function it(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function me(e){var t=e._controlledReadableByteStream;if(!(e._closeRequested||t._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){var r=e._pendingPullIntos.peek();if(r.bytesFilled>0){var n=new TypeError("Insufficient bytes to fill elements in the given buffer");throw D(e,n),n}}it(e),Ee(t)}}function $e(e,t){var r=e._controlledReadableByteStream;if(!(e._closeRequested||r._state!=="readable")){var n=t.buffer,a=t.byteOffset,o=t.byteLength,l=n;if(e._pendingPullIntos.length>0){var d=e._pendingPullIntos.peek();Ve(d.buffer),d.buffer=d.buffer}if(Yt(e),Vr(r))if(rt(r)===0)xe(e,l,a,o);else{e._pendingPullIntos.length>0&&ot(e);var p=new Uint8Array(l,a,o);xt(r,p,!1)}else Ht(r)?(xe(e,l,a,o),on(e)):xe(e,l,a,o);oe(e)}}function D(e,t){var r=e._controlledReadableByteStream;r._state==="readable"&&(en(e),J(e),it(e),Wn(r,t))}function qt(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){var t=e._pendingPullIntos.peek(),r=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),n=Object.create(at.prototype);Pa(n,e,r),e._byobRequest=n}return e._byobRequest}function un(e){var t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function Ne(e,t){var r=e._pendingPullIntos.peek(),n=e._controlledReadableByteStream._state;if(n==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+t>r.byteLength)throw new RangeError("bytesWritten out of range")}r.buffer=r.buffer,sn(e,t)}function Qe(e,t){var r=e._pendingPullIntos.peek(),n=e._controlledReadableByteStream._state;if(n==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+t.byteLength>r.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");var a=t.byteLength;r.buffer=t.buffer,sn(e,a)}function ln(e,t,r,n,a,o,l){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,J(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=o,t._pullAlgorithm=n,t._cancelAlgorithm=a,t._autoAllocateChunkSize=l,t._pendingPullIntos=new L,e._readableStreamController=t;var d=r();z(T(d),function(){t._started=!0,oe(t)},function(p){D(t,p)})}function Ca(e,t,r){var n=Object.create(Ce.prototype),a=function(){},o=function(){return T(void 0)},l=function(){return T(void 0)};t.start!==void 0&&(a=function(){return t.start(n)}),t.pull!==void 0&&(o=function(){return t.pull(n)}),t.cancel!==void 0&&(l=function(p){return t.cancel(p)});var d=t.autoAllocateChunkSize;if(d===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");ln(e,n,a,o,l,r,d)}function Pa(e,t,r){e._associatedReadableByteStreamController=t,e._view=r}function Pt(e){return new TypeError("ReadableStreamBYOBRequest.prototype."+e+" can only be used on a ReadableStreamBYOBRequest")}function be(e){return new TypeError("ReadableByteStreamController.prototype."+e+" can only be used on a ReadableByteStreamController")}function fn(e){return new st(e)}function Pr(e,t){e._reader._readIntoRequests.push(t)}function Ta(e,t,r){var n=e._reader,a=n._readIntoRequests.shift();r?a._closeSteps(t):a._chunkSteps(t)}function dn(e){return e._reader._readIntoRequests.length}function Ht(e){var t=e._reader;return!(t===void 0||!re(t))}var st=function(){function e(t){if(N(t,1,"ReadableStreamBYOBReader"),Ut(t,"First parameter"),V(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!te(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");kr(this,t),this._readIntoRequests=new L}return Object.defineProperty(e.prototype,"closed",{get:function(){return re(this)?this._closedPromise:y(De("closed"))},enumerable:!1,configurable:!0}),e.prototype.cancel=function(t){return t===void 0&&(t=void 0),re(this)?this._ownerReadableStream===void 0?y(de("cancel")):Dt(this,t):y(De("cancel"))},e.prototype.read=function(t){if(!re(this))return y(De("read"));if(!ArrayBuffer.isView(t))return y(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return y(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return y(new TypeError("view's buffer must have non-zero byteLength"));if(Ve(t.buffer),this._ownerReadableStream===void 0)return y(de("read from"));var r,n,a=W(function(l,d){r=l,n=d}),o={_chunkSteps:function(l){return r({value:l,done:!1})},_closeSteps:function(l){return r({value:l,done:!0})},_errorSteps:function(l){return n(l)}};return cn(this,t,o),a},e.prototype.releaseLock=function(){if(!re(this))throw De("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");$(this)}},e}();Object.defineProperties(st.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(st.prototype,C.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function re(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof st}function cn(e,t,r){var n=e._ownerReadableStream;n._disturbed=!0,n._state==="errored"?r._errorSteps(n._storedError):ga(n._readableStreamController,t,r)}function De(e){return new TypeError("ReadableStreamBYOBReader.prototype."+e+" can only be used on a ReadableStreamBYOBReader")}function ye(e,t){var r=e.highWaterMark;if(r===void 0)return t;if(Kr(r)||r<0)throw new RangeError("Invalid highWaterMark");return r}function Ge(e){var t=e.size;return t||function(){return 1}}function Je(e,t){Q(e,t);var r=e?.highWaterMark,n=e?.size;return{highWaterMark:r===void 0?void 0:Mt(r),size:n===void 0?void 0:Ea(n,t+" has member 'size' that")}}function Ea(e,t){return k(e,t),function(r){return Mt(e(r))}}function Aa(e,t){Q(e,t);var r=e?.abort,n=e?.close,a=e?.start,o=e?.type,l=e?.write;return{abort:r===void 0?void 0:qa(r,e,t+" has member 'abort' that"),close:n===void 0?void 0:Wa(n,e,t+" has member 'close' that"),start:a===void 0?void 0:Ba(a,e,t+" has member 'start' that"),write:l===void 0?void 0:ja(l,e,t+" has member 'write' that"),type:o}}function qa(e,t,r){return k(e,r),function(n){return ae(e,t,[n])}}function Wa(e,t,r){return k(e,r),function(){return ae(e,t,[])}}function Ba(e,t,r){return k(e,r),function(n){return tt(e,t,[n])}}function ja(e,t,r){return k(e,r),function(n,a){return ae(e,t,[n,a])}}function hn(e,t){if(!le(e))throw new TypeError(t+" is not a WritableStream.")}function Ia(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}var Oa=typeof AbortController=="function";function Da(){if(Oa)return new AbortController}var K=function(){function e(t,r){t===void 0&&(t={}),r===void 0&&(r={}),t===void 0?t=null:Nr(t,"First parameter");var n=Je(r,"Second parameter"),a=Aa(t,"First parameter");bn(this);var o=a.type;if(o!==void 0)throw new RangeError("Invalid type is specified");var l=Ge(n),d=ye(n,1);Ga(this,a,d,l)}return Object.defineProperty(e.prototype,"locked",{get:function(){if(!le(this))throw Le("locked");return fe(this)},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){return t===void 0&&(t=void 0),le(this)?fe(this)?y(new TypeError("Cannot abort a stream that already has a writer")):Ke(this,t):y(Le("abort"))},e.prototype.close=function(){return le(this)?fe(this)?y(new TypeError("Cannot close a stream that already has a writer")):U(this)?y(new TypeError("Cannot close an already-closing stream")):mn(this):y(Le("close"))},e.prototype.getWriter=function(){if(!le(this))throw Le("getWriter");return pn(this)},e}();Object.defineProperties(K.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(K.prototype,C.toStringTag,{value:"WritableStream",configurable:!0});function pn(e){return new ut(e)}function Fa(e,t,r,n,a,o){a===void 0&&(a=1),o===void 0&&(o=function(){return 1});var l=Object.create(K.prototype);bn(l);var d=Object.create(Pe.prototype);return wn(l,d,e,t,r,n,a,o),l}function bn(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new L,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function le(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof K}function fe(e){return e._writer!==void 0}function Ke(e,t){var r;if(e._state==="closed"||e._state==="errored")return T(void 0);e._writableStreamController._abortReason=t,(r=e._writableStreamController._abortController)===null||r===void 0||r.abort();var n=e._state;if(n==="closed"||n==="errored")return T(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;var a=!1;n==="erroring"&&(a=!0,t=void 0);var o=W(function(l,d){e._pendingAbortRequest={_promise:void 0,_resolve:l,_reject:d,_reason:t,_wasAlreadyErroring:a}});return e._pendingAbortRequest._promise=o,a||Gt(e,t),o}function mn(e){var t=e._state;if(t==="closed"||t==="errored")return y(new TypeError("The stream (in "+t+" state) is not in the writable state and cannot be closed"));var r=W(function(a,o){var l={_resolve:a,_reject:o};e._closeRequest=l}),n=e._writer;return n!==void 0&&e._backpressure&&t==="writable"&&tr(n),Ja(e._writableStreamController),r}function La(e){var t=W(function(r,n){var a={_resolve:r,_reject:n};e._writeRequests.push(a)});return t}function Vt(e,t){var r=e._state;if(r==="writable"){Gt(e,t);return}Jt(e)}function Gt(e,t){var r=e._writableStreamController;e._state="erroring",e._storedError=t;var n=e._writer;n!==void 0&&_n(n,t),!xa(e)&&r._started&&Jt(e)}function Jt(e){e._state="errored",e._writableStreamController[$r]();var t=e._storedError;if(e._writeRequests.forEach(function(a){a._reject(t)}),e._writeRequests=new L,e._pendingAbortRequest===void 0){Fe(e);return}var r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,r._wasAlreadyErroring){r._reject(t),Fe(e);return}var n=e._writableStreamController[xr](r._reason);z(n,function(){r._resolve(),Fe(e)},function(a){r._reject(a),Fe(e)})}function za(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function ka(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Vt(e,t)}function Ma(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0;var t=e._state;t==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";var r=e._writer;r!==void 0&&Tn(r)}function Ua(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Vt(e,t)}function U(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function xa(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function $a(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Na(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Fe(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);var t=e._writer;t!==void 0&&er(t,e._storedError)}function Kt(e,t){var r=e._writer;r!==void 0&&t!==e._backpressure&&(t?no(r):tr(r)),e._backpressure=t}var ut=function(){function e(t){if(N(t,1,"WritableStreamDefaultWriter"),hn(t,"First parameter"),fe(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;var r=t._state;if(r==="writable")!U(t)&&t._backpressure?dt(this):Tr(this),Ze(this);else if(r==="erroring")Wt(this,t._storedError),Ze(this);else if(r==="closed")Tr(this),to(this);else{var n=t._storedError;Wt(this,n),Pn(this,n)}}return Object.defineProperty(e.prototype,"closed",{get:function(){return Z(this)?this._closedPromise:y(X("closed"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!Z(this))throw X("desiredSize");if(this._ownerWritableStream===void 0)throw ve("desiredSize");return Va(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ready",{get:function(){return Z(this)?this._readyPromise:y(X("ready"))},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){return t===void 0&&(t=void 0),Z(this)?this._ownerWritableStream===void 0?y(ve("abort")):Qa(this,t):y(X("abort"))},e.prototype.close=function(){if(!Z(this))return y(X("close"));var t=this._ownerWritableStream;return t===void 0?y(ve("close")):U(t)?y(new TypeError("Cannot close an already-closing stream")):vn(this)},e.prototype.releaseLock=function(){if(!Z(this))throw X("releaseLock");var t=this._ownerWritableStream;t!==void 0&&yn(this)},e.prototype.write=function(t){return t===void 0&&(t=void 0),Z(this)?this._ownerWritableStream===void 0?y(ve("write to")):gn(this,t):y(X("write"))},e}();Object.defineProperties(ut.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(ut.prototype,C.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Z(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof ut}function Qa(e,t){var r=e._ownerWritableStream;return Ke(r,t)}function vn(e){var t=e._ownerWritableStream;return mn(t)}function Ya(e){var t=e._ownerWritableStream,r=t._state;return U(t)||r==="closed"?T(void 0):r==="errored"?y(t._storedError):vn(e)}function Ha(e,t){e._closedPromiseState==="pending"?er(e,t):ro(e,t)}function _n(e,t){e._readyPromiseState==="pending"?En(e,t):ao(e,t)}function Va(e){var t=e._ownerWritableStream,r=t._state;return r==="errored"||r==="erroring"?null:r==="closed"?0:Rn(t._writableStreamController)}function yn(e){var t=e._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");_n(e,r),Ha(e,r),t._writer=void 0,e._ownerWritableStream=void 0}function gn(e,t){var r=e._ownerWritableStream,n=r._writableStreamController,a=Ka(n,t);if(r!==e._ownerWritableStream)return y(ve("write to"));var o=r._state;if(o==="errored")return y(r._storedError);if(U(r)||o==="closed")return y(new TypeError("The stream is closing or closed and cannot be written to"));if(o==="erroring")return y(r._storedError);var l=La(r);return Za(n,t,a),l}var Sn={},Pe=function(){function e(){throw new TypeError("Illegal constructor")}return Object.defineProperty(e.prototype,"abortReason",{get:function(){if(!Tt(this))throw Et("abortReason");return this._abortReason},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"signal",{get:function(){if(!Tt(this))throw Et("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal},enumerable:!1,configurable:!0}),e.prototype.error=function(t){if(t===void 0&&(t=void 0),!Tt(this))throw Et("error");var r=this._controlledWritableStream._state;r==="writable"&&Cn(this,t)},e.prototype[xr]=function(t){var r=this._abortAlgorithm(t);return lt(this),r},e.prototype[$r]=function(){J(this)},e}();Object.defineProperties(Pe.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(Pe.prototype,C.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Tt(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof Pe}function wn(e,t,r,n,a,o,l,d){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,J(t),t._abortReason=void 0,t._abortController=Da(),t._started=!1,t._strategySizeAlgorithm=d,t._strategyHWM=l,t._writeAlgorithm=n,t._closeAlgorithm=a,t._abortAlgorithm=o;var p=Xt(t);Kt(e,p);var b=r(),m=T(b);z(m,function(){t._started=!0,ft(t)},function(v){t._started=!0,Vt(e,v)})}function Ga(e,t,r,n){var a=Object.create(Pe.prototype),o=function(){},l=function(){return T(void 0)},d=function(){return T(void 0)},p=function(){return T(void 0)};t.start!==void 0&&(o=function(){return t.start(a)}),t.write!==void 0&&(l=function(b){return t.write(b,a)}),t.close!==void 0&&(d=function(){return t.close()}),t.abort!==void 0&&(p=function(b){return t.abort(b)}),wn(e,a,o,l,d,p,r,n)}function lt(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Ja(e){Nt(e,Sn,0),ft(e)}function Ka(e,t){try{return e._strategySizeAlgorithm(t)}catch(r){return Zt(e,r),1}}function Rn(e){return e._strategyHWM-e._queueTotalSize}function Za(e,t,r){try{Nt(e,t,r)}catch(o){Zt(e,o);return}var n=e._controlledWritableStream;if(!U(n)&&n._state==="writable"){var a=Xt(e);Kt(n,a)}ft(e)}function ft(e){var t=e._controlledWritableStream;if(!!e._started&&t._inFlightWriteRequest===void 0){var r=t._state;if(r==="erroring"){Jt(t);return}if(e._queue.length!==0){var n=ya(e);n===Sn?Xa(e):eo(e,n)}}}function Zt(e,t){e._controlledWritableStream._state==="writable"&&Cn(e,t)}function Xa(e){var t=e._controlledWritableStream;$a(t),$t(e);var r=e._closeAlgorithm();lt(e),z(r,function(){Ma(t)},function(n){Ua(t,n)})}function eo(e,t){var r=e._controlledWritableStream;Na(r);var n=e._writeAlgorithm(t);z(n,function(){za(r);var a=r._state;if($t(e),!U(r)&&a==="writable"){var o=Xt(e);Kt(r,o)}ft(e)},function(a){r._state==="writable"&&lt(e),ka(r,a)})}function Xt(e){var t=Rn(e);return t<=0}function Cn(e,t){var r=e._controlledWritableStream;lt(e),Gt(r,t)}function Le(e){return new TypeError("WritableStream.prototype."+e+" can only be used on a WritableStream")}function Et(e){return new TypeError("WritableStreamDefaultController.prototype."+e+" can only be used on a WritableStreamDefaultController")}function X(e){return new TypeError("WritableStreamDefaultWriter.prototype."+e+" can only be used on a WritableStreamDefaultWriter")}function ve(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function Ze(e){e._closedPromise=W(function(t,r){e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState="pending"})}function Pn(e,t){Ze(e),er(e,t)}function to(e){Ze(e),Tn(e)}function er(e,t){e._closedPromise_reject!==void 0&&(we(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function ro(e,t){Pn(e,t)}function Tn(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function dt(e){e._readyPromise=W(function(t,r){e._readyPromise_resolve=t,e._readyPromise_reject=r}),e._readyPromiseState="pending"}function Wt(e,t){dt(e),En(e,t)}function Tr(e){dt(e),tr(e)}function En(e,t){e._readyPromise_reject!==void 0&&(we(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function no(e){dt(e)}function ao(e,t){Wt(e,t)}function tr(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}var Er=typeof DOMException<"u"?DOMException:void 0;function oo(e){if(!(typeof e=="function"||typeof e=="object"))return!1;try{return new e,!0}catch{return!1}}function io(){var e=function(r,n){this.message=r||"",this.name=n||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}var so=oo(Er)?Er:io();function Ar(e,t,r,n,a,o){var l=ce(e),d=pn(t);e._disturbed=!0;var p=!1,b=T(void 0);return W(function(m,v){var _;if(o!==void 0){if(_=function(){var u=new so("Aborted","AbortError"),S=[];n||S.push(function(){return t._state==="writable"?Ke(t,u):T(void 0)}),a||S.push(function(){return e._state==="readable"?F(e,u):T(void 0)}),i(function(){return Promise.all(S.map(function(P){return P()}))},!0,u)},o.aborted){_();return}o.addEventListener("abort",_)}function g(){return W(function(u,S){function P(A){A?u():x(E(),P,S)}P(!1)})}function E(){return p?T(!0):x(d._readyPromise,function(){return W(function(u,S){Re(l,{_chunkSteps:function(P){b=x(gn(d,P),void 0,jt),u(!1)},_closeSteps:function(){return u(!0)},_errorSteps:S})})})}if(h(e,l._closedPromise,function(u){n?s(!0,u):i(function(){return Ke(t,u)},!0,u)}),h(t,d._closedPromise,function(u){a?s(!0,u):i(function(){return F(e,u)},!0,u)}),c(e,l._closedPromise,function(){r?s():i(function(){return Ya(d)})}),U(t)||t._state==="closed"){var R=new TypeError("the destination writable stream closed before all data could be piped to it");a?s(!0,R):i(function(){return F(e,R)},!0,R)}we(g());function w(){var u=b;return x(b,function(){return u!==b?w():void 0})}function h(u,S,P){u._state==="errored"?P(u._storedError):Ot(S,P)}function c(u,S,P){u._state==="closed"?P():wt(S,P)}function i(u,S,P){if(p)return;p=!0,t._state==="writable"&&!U(t)?wt(w(),A):A();function A(){z(u(),function(){return f(S,P)},function(O){return f(!0,O)})}}function s(u,S){p||(p=!0,t._state==="writable"&&!U(t)?wt(w(),function(){return f(u,S)}):f(u,S))}function f(u,S){yn(d),$(l),o!==void 0&&o.removeEventListener("abort",_),u?v(S):m(void 0)}})}var Te=function(){function e(){throw new TypeError("Illegal constructor")}return Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!ze(this))throw ke("desiredSize");return rr(this)},enumerable:!1,configurable:!0}),e.prototype.close=function(){if(!ze(this))throw ke("close");if(!he(this))throw new TypeError("The stream is not in a state that permits close");Se(this)},e.prototype.enqueue=function(t){if(t===void 0&&(t=void 0),!ze(this))throw ke("enqueue");if(!he(this))throw new TypeError("The stream is not in a state that permits enqueue");return et(this,t)},e.prototype.error=function(t){if(t===void 0&&(t=void 0),!ze(this))throw ke("error");G(this,t)},e.prototype[zt]=function(t){J(this);var r=this._cancelAlgorithm(t);return Xe(this),r},e.prototype[kt]=function(t){var r=this._controlledReadableStream;if(this._queue.length>0){var n=$t(this);this._closeRequested&&this._queue.length===0?(Xe(this),Ee(r)):ge(this),t._chunkSteps(n)}else Hr(r,t),ge(this)},e}();Object.defineProperties(Te.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(Te.prototype,C.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function ze(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof Te}function ge(e){var t=An(e);if(!!t){if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;var r=e._pullAlgorithm();z(r,function(){e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,ge(e))},function(n){G(e,n)})}}function An(e){var t=e._controlledReadableStream;if(!he(e)||!e._started)return!1;if(V(t)&&rt(t)>0)return!0;var r=rr(e);return r>0}function Xe(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Se(e){if(!!he(e)){var t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(Xe(e),Ee(t))}}function et(e,t){if(!!he(e)){var r=e._controlledReadableStream;if(V(r)&&rt(r)>0)xt(r,t,!1);else{var n=void 0;try{n=e._strategySizeAlgorithm(t)}catch(a){throw G(e,a),a}try{Nt(e,t,n)}catch(a){throw G(e,a),a}}ge(e)}}function G(e,t){var r=e._controlledReadableStream;r._state==="readable"&&(J(e),Xe(e),Wn(r,t))}function rr(e){var t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function uo(e){return!An(e)}function he(e){var t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function qn(e,t,r,n,a,o,l){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,J(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=l,t._strategyHWM=o,t._pullAlgorithm=n,t._cancelAlgorithm=a,e._readableStreamController=t;var d=r();z(T(d),function(){t._started=!0,ge(t)},function(p){G(t,p)})}function lo(e,t,r,n){var a=Object.create(Te.prototype),o=function(){},l=function(){return T(void 0)},d=function(){return T(void 0)};t.start!==void 0&&(o=function(){return t.start(a)}),t.pull!==void 0&&(l=function(){return t.pull(a)}),t.cancel!==void 0&&(d=function(p){return t.cancel(p)}),qn(e,a,o,l,d,r,n)}function ke(e){return new TypeError("ReadableStreamDefaultController.prototype."+e+" can only be used on a ReadableStreamDefaultController")}function fo(e,t){return te(e._readableStreamController)?ho(e):co(e)}function co(e,t){var r=ce(e),n=!1,a=!1,o=!1,l=!1,d,p,b,m,v,_=W(function(h){v=h});function g(){if(n)return a=!0,T(void 0);n=!0;var h={_chunkSteps:function(c){Ye(function(){a=!1;var i=c,s=c;o||et(b._readableStreamController,i),l||et(m._readableStreamController,s),n=!1,a&&g()})},_closeSteps:function(){n=!1,o||Se(b._readableStreamController),l||Se(m._readableStreamController),(!o||!l)&&v(void 0)},_errorSteps:function(){n=!1}};return Re(r,h),T(void 0)}function E(h){if(o=!0,d=h,l){var c=_e([d,p]),i=F(e,c);v(i)}return _}function R(h){if(l=!0,p=h,o){var c=_e([d,p]),i=F(e,c);v(i)}return _}function w(){}return b=Bt(w,g,E),m=Bt(w,g,R),Ot(r._closedPromise,function(h){G(b._readableStreamController,h),G(m._readableStreamController,h),(!o||!l)&&v(void 0)}),[b,m]}function ho(e){var t=ce(e),r=!1,n=!1,a=!1,o=!1,l=!1,d,p,b,m,v,_=W(function(f){v=f});function g(f){Ot(f._closedPromise,function(u){f===t&&(D(b._readableStreamController,u),D(m._readableStreamController,u),(!o||!l)&&v(void 0))})}function E(){re(t)&&($(t),t=ce(e),g(t));var f={_chunkSteps:function(u){Ye(function(){n=!1,a=!1;var S=u,P=u;if(!o&&!l)try{P=Cr(u)}catch(A){D(b._readableStreamController,A),D(m._readableStreamController,A),v(F(e,A));return}o||$e(b._readableStreamController,S),l||$e(m._readableStreamController,P),r=!1,n?w():a&&h()})},_closeSteps:function(){r=!1,o||me(b._readableStreamController),l||me(m._readableStreamController),b._readableStreamController._pendingPullIntos.length>0&&Ne(b._readableStreamController,0),m._readableStreamController._pendingPullIntos.length>0&&Ne(m._readableStreamController,0),(!o||!l)&&v(void 0)},_errorSteps:function(){r=!1}};Re(t,f)}function R(f,u){H(t)&&($(t),t=fn(e),g(t));var S=u?m:b,P=u?b:m,A={_chunkSteps:function(O){Ye(function(){n=!1,a=!1;var ue=u?l:o,pe=u?o:l;if(pe)ue||Qe(S._readableStreamController,O);else{var vr=void 0;try{vr=Cr(O)}catch(St){D(S._readableStreamController,St),D(P._readableStreamController,St),v(F(e,St));return}ue||Qe(S._readableStreamController,O),$e(P._readableStreamController,vr)}r=!1,n?w():a&&h()})},_closeSteps:function(O){r=!1;var ue=u?l:o,pe=u?o:l;ue||me(S._readableStreamController),pe||me(P._readableStreamController),O!==void 0&&(ue||Qe(S._readableStreamController,O),!pe&&P._readableStreamController._pendingPullIntos.length>0&&Ne(P._readableStreamController,0)),(!ue||!pe)&&v(void 0)},_errorSteps:function(){r=!1}};cn(t,f,A)}function w(){if(r)return n=!0,T(void 0);r=!0;var f=qt(b._readableStreamController);return f===null?E():R(f._view,!1),T(void 0)}function h(){if(r)return a=!0,T(void 0);r=!0;var f=qt(m._readableStreamController);return f===null?E():R(f._view,!0),T(void 0)}function c(f){if(o=!0,d=f,l){var u=_e([d,p]),S=F(e,u);v(S)}return _}function i(f){if(l=!0,p=f,o){var u=_e([d,p]),S=F(e,u);v(S)}return _}function s(){}return b=Wr(s,w,c),m=Wr(s,h,i),g(t),[b,m]}function po(e,t){Q(e,t);var r=e,n=r?.autoAllocateChunkSize,a=r?.cancel,o=r?.pull,l=r?.start,d=r?.type;return{autoAllocateChunkSize:n===void 0?void 0:Yr(n,t+" has member 'autoAllocateChunkSize' that"),cancel:a===void 0?void 0:bo(a,r,t+" has member 'cancel' that"),pull:o===void 0?void 0:mo(o,r,t+" has member 'pull' that"),start:l===void 0?void 0:vo(l,r,t+" has member 'start' that"),type:d===void 0?void 0:_o(d,t+" has member 'type' that")}}function bo(e,t,r){return k(e,r),function(n){return ae(e,t,[n])}}function mo(e,t,r){return k(e,r),function(n){return ae(e,t,[n])}}function vo(e,t,r){return k(e,r),function(n){return tt(e,t,[n])}}function _o(e,t){if(e=""+e,e!=="bytes")throw new TypeError(t+" '"+e+"' is not a valid enumeration value for ReadableStreamType");return e}function yo(e,t){Q(e,t);var r=e?.mode;return{mode:r===void 0?void 0:go(r,t+" has member 'mode' that")}}function go(e,t){if(e=""+e,e!=="byob")throw new TypeError(t+" '"+e+"' is not a valid enumeration value for ReadableStreamReaderMode");return e}function So(e,t){Q(e,t);var r=e?.preventCancel;return{preventCancel:Boolean(r)}}function qr(e,t){Q(e,t);var r=e?.preventAbort,n=e?.preventCancel,a=e?.preventClose,o=e?.signal;return o!==void 0&&wo(o,t+" has member 'signal' that"),{preventAbort:Boolean(r),preventCancel:Boolean(n),preventClose:Boolean(a),signal:o}}function wo(e,t){if(!Ia(e))throw new TypeError(t+" is not an AbortSignal.")}function Ro(e,t){Q(e,t);var r=e?.readable;At(r,"readable","ReadableWritablePair"),Ut(r,t+" has member 'readable' that");var n=e?.writable;return At(n,"writable","ReadableWritablePair"),hn(n,t+" has member 'writable' that"),{readable:r,writable:n}}var j=function(){function e(t,r){t===void 0&&(t={}),r===void 0&&(r={}),t===void 0?t=null:Nr(t,"First parameter");var n=Je(r,"Second parameter"),a=po(t,"First parameter");if(nr(this),a.type==="bytes"){if(n.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");var o=ye(n,0);Ca(this,a,o)}else{var l=Ge(n),o=ye(n,1);lo(this,a,o,l)}}return Object.defineProperty(e.prototype,"locked",{get:function(){if(!Y(this))throw ee("locked");return V(this)},enumerable:!1,configurable:!0}),e.prototype.cancel=function(t){return t===void 0&&(t=void 0),Y(this)?V(this)?y(new TypeError("Cannot cancel a stream that already has a reader")):F(this,t):y(ee("cancel"))},e.prototype.getReader=function(t){if(t===void 0&&(t=void 0),!Y(this))throw ee("getReader");var r=yo(t,"First parameter");return r.mode===void 0?ce(this):fn(this)},e.prototype.pipeThrough=function(t,r){if(r===void 0&&(r={}),!Y(this))throw ee("pipeThrough");N(t,1,"pipeThrough");var n=Ro(t,"First parameter"),a=qr(r,"Second parameter");if(V(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(fe(n.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");var o=Ar(this,n.writable,a.preventClose,a.preventAbort,a.preventCancel,a.signal);return we(o),n.readable},e.prototype.pipeTo=function(t,r){if(r===void 0&&(r={}),!Y(this))return y(ee("pipeTo"));if(t===void 0)return y("Parameter 1 is required in 'pipeTo'.");if(!le(t))return y(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));var n;try{n=qr(r,"Second parameter")}catch(a){return y(a)}return V(this)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):fe(t)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Ar(this,t,n.preventClose,n.preventAbort,n.preventCancel,n.signal)},e.prototype.tee=function(){if(!Y(this))throw ee("tee");var t=fo(this);return _e(t)},e.prototype.values=function(t){if(t===void 0&&(t=void 0),!Y(this))throw ee("values");var r=So(t,"First parameter");return va(this,r.preventCancel)},e}();Object.defineProperties(j.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(j.prototype,C.toStringTag,{value:"ReadableStream",configurable:!0});typeof C.asyncIterator=="symbol"&&Object.defineProperty(j.prototype,C.asyncIterator,{value:j.prototype.values,writable:!0,configurable:!0});function Bt(e,t,r,n,a){n===void 0&&(n=1),a===void 0&&(a=function(){return 1});var o=Object.create(j.prototype);nr(o);var l=Object.create(Te.prototype);return qn(o,l,e,t,r,n,a),o}function Wr(e,t,r){var n=Object.create(j.prototype);nr(n);var a=Object.create(Ce.prototype);return ln(n,a,e,t,r,0,void 0),n}function nr(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function Y(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof j}function V(e){return e._reader!==void 0}function F(e,t){if(e._disturbed=!0,e._state==="closed")return T(void 0);if(e._state==="errored")return y(e._storedError);Ee(e);var r=e._reader;r!==void 0&&re(r)&&(r._readIntoRequests.forEach(function(a){a._closeSteps(void 0)}),r._readIntoRequests=new L);var n=e._readableStreamController[zt](t);return ne(n,jt)}function Ee(e){e._state="closed";var t=e._reader;t!==void 0&&(Ur(t),H(t)&&(t._readRequests.forEach(function(r){r._closeSteps()}),t._readRequests=new L))}function Wn(e,t){e._state="errored",e._storedError=t;var r=e._reader;r!==void 0&&(Lt(r,t),H(r)?(r._readRequests.forEach(function(n){n._errorSteps(t)}),r._readRequests=new L):(r._readIntoRequests.forEach(function(n){n._errorSteps(t)}),r._readIntoRequests=new L))}function ee(e){return new TypeError("ReadableStream.prototype."+e+" can only be used on a ReadableStream")}function Bn(e,t){Q(e,t);var r=e?.highWaterMark;return At(r,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Mt(r)}}var jn=function(e){return e.byteLength};try{Object.defineProperty(jn,"name",{value:"size",configurable:!0})}catch{}var ar=function(){function e(t){N(t,1,"ByteLengthQueuingStrategy"),t=Bn(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}return Object.defineProperty(e.prototype,"highWaterMark",{get:function(){if(!jr(this))throw Br("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){if(!jr(this))throw Br("size");return jn},enumerable:!1,configurable:!0}),e}();Object.defineProperties(ar.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(ar.prototype,C.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Br(e){return new TypeError("ByteLengthQueuingStrategy.prototype."+e+" can only be used on a ByteLengthQueuingStrategy")}function jr(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof ar}var In=function(){return 1};try{Object.defineProperty(In,"name",{value:"size",configurable:!0})}catch{}var or=function(){function e(t){N(t,1,"CountQueuingStrategy"),t=Bn(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}return Object.defineProperty(e.prototype,"highWaterMark",{get:function(){if(!Or(this))throw Ir("highWaterMark");return this._countQueuingStrategyHighWaterMark},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){if(!Or(this))throw Ir("size");return In},enumerable:!1,configurable:!0}),e}();Object.defineProperties(or.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(or.prototype,C.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Ir(e){return new TypeError("CountQueuingStrategy.prototype."+e+" can only be used on a CountQueuingStrategy")}function Or(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof or}function Co(e,t){Q(e,t);var r=e?.flush,n=e?.readableType,a=e?.start,o=e?.transform,l=e?.writableType;return{flush:r===void 0?void 0:Po(r,e,t+" has member 'flush' that"),readableType:n,start:a===void 0?void 0:To(a,e,t+" has member 'start' that"),transform:o===void 0?void 0:Eo(o,e,t+" has member 'transform' that"),writableType:l}}function Po(e,t,r){return k(e,r),function(n){return ae(e,t,[n])}}function To(e,t,r){return k(e,r),function(n){return tt(e,t,[n])}}function Eo(e,t,r){return k(e,r),function(n,a){return ae(e,t,[n,a])}}var I=function(){function e(t,r,n){t===void 0&&(t={}),r===void 0&&(r={}),n===void 0&&(n={}),t===void 0&&(t=null);var a=Je(r,"Second parameter"),o=Je(n,"Third parameter"),l=Co(t,"First parameter");if(l.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(l.writableType!==void 0)throw new RangeError("Invalid writableType specified");var d=ye(o,0),p=Ge(o),b=ye(a,1),m=Ge(a),v,_=W(function(g){v=g});Ao(this,_,b,m,d,p),Wo(this,l),l.start!==void 0?v(l.start(this._transformStreamController)):v(void 0)}return Object.defineProperty(e.prototype,"readable",{get:function(){if(!Dr(this))throw Lr("readable");return this._readable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"writable",{get:function(){if(!Dr(this))throw Lr("writable");return this._writable},enumerable:!1,configurable:!0}),e}();Object.defineProperties(I.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(I.prototype,C.toStringTag,{value:"TransformStream",configurable:!0});function Ao(e,t,r,n,a,o){function l(){return t}function d(_){return Io(e,_)}function p(_){return Oo(e,_)}function b(){return Do(e)}e._writable=Fa(l,d,b,p,r,n);function m(){return Fo(e)}function v(_){return ht(e,_),T(void 0)}e._readable=Bt(l,m,v,a,o),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,pt(e,!0),e._transformStreamController=void 0}function Dr(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof I}function ct(e,t){G(e._readable._readableStreamController,t),ht(e,t)}function ht(e,t){On(e._transformStreamController),Zt(e._writable._writableStreamController,t),e._backpressure&&pt(e,!1)}function pt(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=W(function(r){e._backpressureChangePromise_resolve=r}),e._backpressure=t}var bt=function(){function e(){throw new TypeError("Illegal constructor")}return Object.defineProperty(e.prototype,"desiredSize",{get:function(){if(!Me(this))throw Ue("desiredSize");var t=this._controlledTransformStream._readable._readableStreamController;return rr(t)},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(t){if(t===void 0&&(t=void 0),!Me(this))throw Ue("enqueue");Dn(this,t)},e.prototype.error=function(t){if(t===void 0&&(t=void 0),!Me(this))throw Ue("error");Bo(this,t)},e.prototype.terminate=function(){if(!Me(this))throw Ue("terminate");jo(this)},e}();Object.defineProperties(bt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}});typeof C.toStringTag=="symbol"&&Object.defineProperty(bt.prototype,C.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Me(e){return!B(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof bt}function qo(e,t,r,n){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=r,t._flushAlgorithm=n}function Wo(e,t){var r=Object.create(bt.prototype),n=function(o){try{return Dn(r,o),T(void 0)}catch(l){return y(l)}},a=function(){return T(void 0)};t.transform!==void 0&&(n=function(o){return t.transform(o,r)}),t.flush!==void 0&&(a=function(){return t.flush(r)}),qo(e,r,n,a)}function On(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function Dn(e,t){var r=e._controlledTransformStream,n=r._readable._readableStreamController;if(!he(n))throw new TypeError("Readable side is not in a state that permits enqueue");try{et(n,t)}catch(o){throw ht(r,o),r._readable._storedError}var a=uo(n);a!==r._backpressure&&pt(r,!0)}function Bo(e,t){ct(e._controlledTransformStream,t)}function Fr(e,t){var r=e._transformAlgorithm(t);return ne(r,void 0,function(n){throw ct(e._controlledTransformStream,n),n})}function jo(e){var t=e._controlledTransformStream,r=t._readable._readableStreamController;Se(r);var n=new TypeError("TransformStream terminated");ht(t,n)}function Io(e,t){var r=e._transformStreamController;if(e._backpressure){var n=e._backpressureChangePromise;return ne(n,function(){var a=e._writable,o=a._state;if(o==="erroring")throw a._storedError;return Fr(r,t)})}return Fr(r,t)}function Oo(e,t){return ct(e,t),T(void 0)}function Do(e){var t=e._readable,r=e._transformStreamController,n=r._flushAlgorithm();return On(r),ne(n,function(){if(t._state==="errored")throw t._storedError;Se(t._readableStreamController)},function(a){throw ct(e,a),t._storedError})}function Fo(e){return pt(e,!1),e._backpressureChangePromise}function Ue(e){return new TypeError("TransformStreamDefaultController.prototype."+e+" can only be used on a TransformStreamDefaultController")}function Lr(e){return new TypeError("TransformStream.prototype."+e+" can only be used on a TransformStream")}var ir=ia(zn(),1),Lo=32768,mt=(e,t)=>ir.default.hash(e,t),kn=async(e,t)=>{let r=Math.min(Lo,e.size),n=Math.ceil(e.size/r),a=new ir.default.ArrayBuffer;for(let o=0;o<n;o++){let d=await e.slice(o*r,(o+1)*r).arrayBuffer();a.append(d)}return a.end(t)};var zo=async(e,t)=>mt(`${e}${t}`),ko=(e,t)=>e.sessionId&&e.sessionId===t.sessionId&&e.sourceLastSeq&&e.sourceLastSeq===t.sourceLastSeq?e.sourceLastSeq:null,Mn=(e,t)=>{if(!e)return-1;if(!t)return 1;if(e===t)return 0;let r=parseInt(e,10),n=parseInt(t,10);return r-n},Ae=class extends I{constructor({batchSize:t}){super({transform(r,n){if(this.entries.push(r),this.entries.length>=t){let a=this.entries.splice(0,t);n.enqueue(a)}},flush(r){this.entries.length>0&&r.enqueue(this.entries)},entries:[]},{highWaterMark:1024*4},{highWaterMark:1024*4})}};var Un=async(e,t,{batchSize:r={source:1024,target:256}}={})=>{let n=crypto.randomUUID(),a={docsRead:0,docsWritten:0},[{uuid:o},{uuid:l,updateSeq:d}]=await Promise.all([t.replicator.getInfo(),e.replicator.getInfo()]),p=await zo(o,l),[b,m]=await Promise.all([t.replicator.getLog(p),e.replicator.getLog(p)]),v=ko(b,m);if(Mn(v,d)===0)return a;let _=!1;for(;!_;){let g={};if(await e.replicator.getChanges(v,{limit:r.source},g).pipeThrough(new Ae({batchSize:r.target})).pipeThrough(t.replicator.getDiff()).pipeThrough(new Ae({batchSize:r.source})).pipeThrough(e.replicator.getRevs(g)).pipeThrough(new Ae({batchSize:r.target})).pipeTo(t.replicator.saveRevs(g)),a.lastSeq=g.lastSeq,a.docsRead+=g.docsRead,a.docsWritten+=g.docsWritten,g.lastSeq!==v){m.sessionId=n,m.sourceLastSeq=g.lastSeq,b.sessionId=n,b.sourceLastSeq=g.lastSeq;let[{rev:E},{rev:R}]=await Promise.all([t.replicator.saveLog(b),e.replicator.saveLog(m)]);b._rev=E,m._rev=R}v=g.lastSeq,_=g.numberOfChanges<r.source||Mn(g.lastSeq,d)>=0}return a},ie=class extends EventTarget{constructor(){super(),this.replicator=null}async init(){throw new Error(`init is not implemented for ${this.constructor.name}`)}async destroy(){throw new Error(`destroy is not implemented for ${this.constructor.name}`)}async getChanges(){throw new Error(`getChanges is not implemented for ${this.constructor.name}`)}async getDoc(t){throw new Error(`getDoc is not implemented for ${this.constructor.name}`)}async saveDoc(t){throw new Error(`saveDoc is not implemented for ${this.constructor.name}`)}async deleteDoc(t){throw new Error(`deleteDoc is not implemented for ${this.constructor.name}`)}async getDocs(t){throw new Error(`getDocs is not implemented for ${this.constructor.name}`)}async pull(t,r){let n=await Un(t,this,r);return n.docsWritten>0&&this.dispatchEvent(new Event("change")),n}push(t,r){return Un(this,t,r)}sync(t){return Promise.all([this.pull(t),this.push(t)])}};function Nn(e){for(var t,r,n,a=e.rev_tree.slice(),o;o=a.pop();){var l=o.ids,d=l[2],p=o.pos;if(d.length){for(var b=0,m=d.length;b<m;b++)a.push({pos:p+1,ids:d[b]});continue}var v=!!l[1].deleted,_=l[0];(!t||(n!==v?n:r!==p?r<p:t<_))&&(t=_,r=p,n=v)}return r+"-"+t}function Qn(e,t){for(var r=e.slice(),n;n=r.pop();)for(var a=n.pos,o=n.ids,l=o[2],d=t(l.length===0,a,o[0],n.ctx,o[1]),p=0,b=l.length;p<b;p++)r.push({pos:a+1,ids:l[p],ctx:d})}function Yn(e){var t=[];return Qn(e.rev_tree,function(r,n,a,o,l){l.status==="available"&&!r&&(t.push(n+"-"+a),l.status="missing")}),t}function vt(e){for(var t=[],r=e.slice(),n;n=r.pop();){var a=n.pos,o=n.ids,l=o[0],d=o[1],p=o[2],b=p.length===0,m=n.history?n.history.slice():[];m.push({id:l,opts:d}),b&&t.push({pos:a+1-m.length,ids:m});for(var v=0,_=p.length;v<_;v++)r.push({pos:a+1,ids:p[v],history:m})}return t.reverse()}function Mo(e,t){return e.pos-t.pos}function Uo(e,t,r){for(var n=0,a=e.length,o;n<a;)o=n+a>>>1,r(e[o],t)<0?n=o+1:a=o;return n}function xo(e,t,r){var n=Uo(e,t,r);e.splice(n,0,t)}function xn(e,t){for(var r,n,a=t,o=e.length;a<o;a++){var l=e[a],d=[l.id,l.opts,[]];n?(n[2].push(d),n=d):r=n=d}return r}function $o(e,t){return e[0]<t[0]?-1:1}function $n(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var a=r.pop(),o=a.tree1,l=a.tree2;(o[1].status||l[1].status)&&(o[1].status=o[1].status==="available"||l[1].status==="available"?"available":"missing");for(var d=0;d<l[2].length;d++){if(!o[2][0]){n="new_leaf",o[2][0]=l[2][d];continue}for(var p=!1,b=0;b<o[2].length;b++)o[2][b][0]===l[2][d][0]&&(r.push({tree1:o[2][b],tree2:l[2][d]}),p=!0);p||(n="new_branch",xo(o[2],l[2][d],$o))}}return{conflicts:n,tree:e}}function Hn(e,t,r){var n=[],a=!1,o=!1,l;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var d=0,p=e.length;d<p;d++){var b=e[d];if(b.pos===t.pos&&b.ids[0]===t.ids[0])l=$n(b.ids,t.ids),n.push({pos:b.pos,ids:l.tree}),a=a||l.conflicts,o=!0;else if(r!==!0){var m=b.pos<t.pos?b:t,v=b.pos<t.pos?t:b,_=v.pos-m.pos,g=[],E=[];for(E.push({ids:m.ids,diff:_,parent:null,parentIdx:null});E.length>0;){var R=E.pop();if(R.diff===0){R.ids[0]===v.ids[0]&&g.push(R);continue}for(var w=R.ids[2],h=0,c=w.length;h<c;h++)E.push({ids:w[h],diff:R.diff-1,parent:R.ids,parentIdx:h})}var i=g[0];i?(l=$n(i.ids,v.ids),i.parent[2][i.parentIdx]=l.tree,n.push({pos:m.pos,ids:m.ids}),a=a||l.conflicts,o=!0):n.push(b)}else n.push(b)}return o||n.push(t),n.sort(Mo),{tree:n,conflicts:a||"internal_node"}}function No(e,t){for(var r=vt(e),n,a,o=0,l=r.length;o<l;o++){var d=r[o],p=d.ids,b;if(p.length>t){n||(n={});var m=p.length-t;b={pos:d.pos+m,ids:xn(p,m)};for(var v=0;v<m;v++){var _=d.pos+v+"-"+p[v].id;n[_]=!0}}else b={pos:d.pos,ids:xn(p,0)};a?a=Hn(a,b,!0).tree:a=[b]}return n&&Qn(a,function(g,E,R){delete n[E+"-"+R]}),{tree:a,revs:n?Object.keys(n):[]}}function Vn(e,t,r){var n=Hn(e,t),a=No(n.tree,r);return{tree:a.tree,stemmedRevs:a.revs,conflicts:n.conflicts}}var Qo=1e3,sr={status:"available"},Gn={status:"missing"},Yo=e=>mt(JSON.stringify(e)),Ho=e=>{let[t,r]=e.split("-");return[parseInt(t,10),r]},Vo=e=>{let t={};for(let r in e)r.startsWith("_")||(t[r]=e[r]);if(e._attachments){t._attachments={};for(let r in e._attachments){let{digest:n,revpos:a}=e._attachments[r];t._attachments[r]={digest:n,revpos:a}}}return t},Go=(e,t)=>{let r=e.split("-"),n=parseInt(r[0],10),a=r[1],o=vt(t),l=null;for(var d=0;d<o.length;d++){let m=o[d],v=m.ids.map(({id:g})=>g).indexOf(a);(v===n-1||!l&&v!==-1)&&(l=m)}if(!l)throw new Error("invalid rev tree");let p=l.ids.map(({id:m})=>m).indexOf(a)+1,b=l.ids.length-p;return l.ids.splice(p,b),l.ids.reverse(),{start:l.pos+l.ids.length-1,ids:l.ids.map(({id:m})=>m)}},Jn=e=>({id:e,tree:[],attachments:{},revs:{}}),Kn=(e,t,{newEdits:r})=>{for(let{doc:n}of t){let{_id:a,_rev:o,_deleted:l,_attachments:d,_revisions:p}=n,b=Vo(n),m,v,_;if(r){let c=Yo({...b,_id:a,_rev:o,_deleted:l}),i=r&&e.deleted;if(o||i){let s=i?e.rev:o,[f,u]=Ho(s);v=f+1,_=[{pos:f,ids:[u,Gn,[[c,sr,[]]]]}]}else v=1,_=[{pos:1,ids:[c,sr,[]]}];m=`${v}-${c}`}else{if(!p)throw new Error("missing _revisions");v=p.start;let c=v-p.ids.length+1,i=[p.ids[0],sr,[]];for(let s=1,f=p.ids.length;s<f;s++)i=[p.ids[s],Gn,[i]];m=o,_=[{pos:c,ids:i}]}let{tree:g,stemmedRevs:E}=Vn(e.tree,_[0],Qo);e.tree=g,e.revs[m]={data:b,deleted:!!l};let R=Nn({rev_tree:g});if(e.rev=R,e.deleted=e.revs[R].deleted,d)for(let c in d){let i=d[c],{stub:s,data:f,digest:u}=i;if(!u)throw new Error("missing attachment digest");if(s){if(!(u in e.attachments))throw new Error("missing attachment data for stub");e.attachments[u].revs[m]=!0}else u in e.attachments?e.attachments[u].revs[m]=!0:(b._attachments[c].revpos=v,e.attachments[u]={data:f,revs:{[m]:!0}})}let h=Yn({rev_tree:g}).concat(E);for(let c of h){delete e.revs[c];for(let i in e.attachments){let s=e.attachments[i].revs;delete s[c],Object.keys(s).length===0&&delete e.attachments[i]}}}return e.available=Object.keys(e.revs).map(n=>[e.id,n]),e},_t=(e,t)=>{let{id:r,tree:n,revs:a,attachments:o}=e;if(!(t in a))throw new Error(`rev not found: '${r}@${t.rev}'`);let{data:l,deleted:d}=a[t],p=Go(t,n);if(l._attachments)for(let b in l._attachments){let m=l._attachments[b],v=o[m.digest].data;m.data=v,m.content_type=v.type,m.length=v.size}return{...l,_id:r,_rev:t,_deleted:d,_revisions:p}},Zn=({id:e,rev:t,seq:r,deleted:n,tree:a})=>{let l=vt(a).map(({pos:d,ids:p})=>({rev:`${d+p.length-1}-${p.pop().id}`}));return{seq:r,id:e,changes:l,deleted:n}};var q="docs",M="meta",Jo=async e=>{let t=await kn(e,!0);return`md5-${btoa(t)}`},qe=class{constructor({name:t}){this.name=t,this.db=null}async init(){if(!this.db)return new Promise((t,r)=>{let n=indexedDB.open(this.name);n.onerror=a=>r(a.target.error),n.onblocked=a=>r(a),n.onupgradeneeded=a=>{let o=a.target.result,l="id",d=o.createObjectStore(q,{keyPath:l});d.createIndex("seq","seq",{unique:!0}),d.createIndex("revs","available",{multiEntry:!0}),o.createObjectStore(M,{keyPath:l})},n.onsuccess=a=>{this.db=a.target.result,this.db.onabort=()=>this.db.close(),this.db.onversionchange=()=>this.db.close();let o=this.db.transaction(M,"readwrite");o.oncomplete=()=>t();let l=o.objectStore(M);l.get(M).onsuccess=d=>{if(!d.target.result){let p={id:M,doc_count:0,seq:0,db_uuid:crypto.randomUUID()};l.put(p)}}}})}destroy(){return new Promise((t,r)=>{this.db.close();let n=indexedDB.deleteDatabase(this.name);n.onsuccess=()=>{this.db=null,this.metadata=null,t()}})}getMetadata(){return new Promise((t,r)=>{let n=this.db.transaction(M,"readonly");n.onerror=a=>r(a),n.objectStore(M).get(M).onsuccess=a=>t(a.target.result)})}getLocalDoc(t){let r=`_local/${t}`;return new Promise((n,a)=>{let o=this.db.transaction(q,"readonly");o.onerror=l=>a(l),o.objectStore(q).get(r).onsuccess=l=>{let d=l.target.result,p=d?d.data:{_id:r};n(p)}})}saveLocalDoc(t){let r={id:t._id,data:{...t,_rev:t._rev?t._rev+1:1}};return new Promise((n,a)=>{let o=this.db.transaction(q,"readwrite");o.onerror=l=>a(l),o.objectStore(q).put(r).onsuccess=()=>n({rev:t._rev})})}async getDiff(t){return new Promise((r,n)=>{let a=this.db.transaction(q,"readonly");a.onerror=d=>n(d);let o=a.objectStore(q).index("revs"),l=[];a.oncomplete=()=>{let d=l.filter(({revs:p})=>p.length>0);r(d)};for(let{id:d,revs:p}of t){let b={id:d,revs:[]};for(let{rev:m}of p)o.getKey([d,m]).onsuccess=v=>{v.target.result||b.revs.push({rev:m})};l.push(b)}})}async getRevs(t){return new Promise((r,n)=>{let a=this.db.transaction(q,"readonly");a.onerror=l=>n(l);let o=a.objectStore(q);a.oncomplete=()=>r(t);for(let l of t){let{id:d,revs:p}=l;o.get(d).onsuccess=b=>{let m=b.target.result;if(!m)throw new Error(`doc not found: '${d}'`);for(let v of p)v.doc=_t(m,v.rev)}}})}async saveDocs(t){let r=t.map(n=>({id:n._id,revs:[{doc:n}]}));return this.saveRevs(r,{newEdits:!0})}async saveRevs(t,{newEdits:r}){for(let{id:n,revs:a}of t)for(let{doc:{_attachments:o}}of a)if(!!o)for(let l in o){let d=o[l],{data:p}=d;!p||(d.digest=await Jo(p))}return new Promise((n,a)=>{let o=this.db.transaction([q,M],"readwrite");o.onerror=b=>a(b);let l=[];o.oncomplete=()=>n(l);let d=o.objectStore(q),p=o.objectStore(M);p.get(M).onsuccess=b=>{let m=b.target.result,v=t.length;for(let{id:_,revs:g}of t)d.get(_).onsuccess=E=>{let R=E.target.result,w=!R,h=R&&R.deleted,c=R||Jn(_),i=Kn(c,g,{newEdits:r});i.seq=++m.seq;let s=i.deleted;d.put(i).onsuccess=()=>{l.docsWritten++;let f=0;w?f=1:(!h&&s&&(f=-1),h&&!s&&(f=1)),m.doc_count+=f,l.push({id:_,rev:i.rev}),v--,v===0&&p.put(m)}}}})}async getChanges({since:t,limit:r}={}){return t=t||-1,r=r||-1,new Promise((n,a)=>{let o=this.db.transaction(q,"readonly");o.onerror=m=>a(m);let l=o.objectStore(q).index("seq"),d=[],p=-1,b=0;l.openCursor(IDBKeyRange.lowerBound(t,!0)).onsuccess=m=>{if(!m.target.result)return;let v=m.target.result,_=v.value,g=Zn(_);d.push(g),p=g.seq,b++,b!==r&&v.continue()},o.oncomplete=()=>n({changes:d,lastSeq:p})})}getDoc(t){return new Promise((r,n)=>{let a=this.db.transaction(q,"readonly");a.onerror=o=>n(o),a.objectStore(q).get(t).onsuccess=o=>{let l=o.target.result;if(!l)return n(new Error("not found"));let d=_t(l,l.rev);r(d)}})}getDocs(t,r){let n=this.db;return new j({start(a){let o=n.transaction(q,"readonly");o.onerror=d=>{console.error("error getDocs",d),a.error(d)},o.oncomplete=()=>a.close();let l=o.objectStore(q);l.openCursor(t,r).onsuccess=d=>{if(!d.target.result)return;let p=d.target.result,b=p.value,m=_t(b,b.rev);m._deleted||a.enqueue(m),p.continue()}}})}};var se=class{async getInfo(){throw new Error(`getInfo is not implemented for ${this.constructor.name}`)}async getLog(t){throw new Error(`getLog is not implemented for ${this.constructor.name}`)}async saveLog(t){throw new Error(`saveLog is not implemented for ${this.constructor.name}`)}getChanges(t,{limit:r}={},n={}){throw new Error(`getChanges is not implemented for ${this.constructor.name}`)}getDiff(){throw new Error(`getDiff is not implemented for ${this.constructor.name}`)}getRevs(t={}){throw new Error(`getRevs is not implemented for ${this.constructor.name}`)}saveRevs(t={}){throw new Error(`saveRevs is not implemented for ${this.constructor.name}`)}};var ur=class extends j{constructor(t,{since:r,limit:n},a={}){let o;super({async start(l){let d=await t.getChanges({since:r,limit:n});o=d.changes,a.numberOfChanges=o.length,a.lastSeq=d.lastSeq},pull(l){if(o.length===0){l.close();return}let{id:d,changes:p}=o.shift();l.enqueue({id:d,revs:p})}})}},lr=class extends I{constructor(t){super({async transform(r,n){let a=r.map(({id:l})=>l),o=await t.getDiff(r);for(let l of o)n.enqueue(l)}},{highWaterMark:8},{highWaterMark:1024})}},fr=class extends I{constructor(t,r){r.docsRead=0,super({async transform(n,a){if(n.length===0)return;let o=await t.getRevs(n);for(let l of o)r.docsRead++,a.enqueue(l)}},{highWaterMark:8})}},dr=class extends K{constructor(t,r={}){r.docsWritten=0,super({async write(n){let a=await t.saveRevs(n,{newEdits:!1});r.docsWritten+=a.length}},{highWaterMark:1024*4})}},We=class extends se{constructor(t){super(),this.adapter=t}async getInfo(){let{db_uuid:t,seq:r}=await this.adapter.getMetadata();return{uuid:t,updateSeq:r}}getLog(t){return this.adapter.getLocalDoc(t)}saveLog(t){return this.adapter.saveLocalDoc(t)}getChanges(t,{limit:r}={},n={}){return new ur(this.adapter,{since:t,limit:r},n)}getDiff(){return new lr(this.adapter)}getRevs(t={}){return new fr(this.adapter,t)}saveRevs(t={}){return new dr(this.adapter,t)}};var yt=class extends ie{constructor({name:t}){super(),this.name=t,this.adapter=new qe({name:t}),this.replicator=new We(this.adapter)}init(){return this.adapter.init()}destroy(){return this.adapter.destroy()}async saveDoc(t){let[r]=await this.adapter.saveDocs([t]);return this.dispatchEvent(new Event("change")),r}getDocs({startkey:t,endkey:r,descending:n}){let a=IDBKeyRange.bound(t,r),o=n?"prev":"next";return this.adapter.getDocs(a,o)}getDoc(t){return this.adapter.getDoc(t)}};var Be=class{constructor({url:t,headers:r}){this.url=t,this.root=t.pathname,this.headers=r}async getServerInfo(){let t=new URL(this.url);t.pathname="/";let r=await fetch(t,{headers:this.headers});if(r.status!==200)throw new Error("Remote server not reachable");return r.json()}async getInfo(){let t=new URL(this.url),r=await fetch(t,{headers:this.headers});if(r.status!==200)throw new Error("Remote database not reachable");return r.json()}async getDoc(t){let r=new URL(`${this.root}/${t}`,this.url),n=await fetch(r,{headers:this.headers});if(n.status!==200)throw new Error("Could not get doc");return n}async saveDoc(t){let r=new URL(`${this.root}/${t._id}`,this.url),n=JSON.stringify(t),a=await fetch(r,{headers:{...this.headers,"Content-Type":"application/json"},method:"put",body:n});if(a.status!==201)throw new Error("Could not save doc");return a}async deleteDoc(t){let r=new URL(`${this.root}/${t._id}`,this.url);r.searchParams.set("rev",t._rev);let n=await fetch(r,{headers:{...this.headers},method:"delete"});if(n.status!==200)throw new Error("Could not delete doc");return n}async getChanges(t,{limit:r}={}){let n=new URL(`${this.root}/_changes`,this.url);n.searchParams.set("feed","continuous"),n.searchParams.set("timeout","0"),n.searchParams.set("style","all_docs"),t&&n.searchParams.set("since",t),r&&(n.searchParams.set("limit",r),n.searchParams.set("seq_interval",r));let a=await fetch(n,{headers:this.headers});if(a.status!==200)throw new Error("Could not get changes");return a}async revsDiff(t){let r=new URL(`${this.root}/_revs_diff`,this.url),n=JSON.stringify(t),a=await fetch(r,{headers:{...this.headers,"Content-Type":"application/json"},method:"post",body:n});if(a.status!==200)throw new Error("Could not get revs diff");return a}async bulkGet(t){let r=new URL(`${this.root}/_bulk_get`,this.url);r.searchParams.set("revs","true"),r.searchParams.set("attachments","true");let n=JSON.stringify({docs:t}),a=await fetch(r,{headers:{...this.headers,"Content-Type":"application/json"},method:"post",body:n});if(a.status!==200)throw new Error("Could not get docs multipart");return a}async bulkDocs(t){let r=new URL(`${this.root}/_bulk_docs`,this.url),n=JSON.stringify({docs:t,new_edits:!1}),a=await fetch(r,{headers:{...this.headers,"Content-Type":"application/json"},method:"post",body:n});if(a.status!==201)throw new Error("Could not save bulk docs");return a}};var je=class{constructor(){this.decoder=new TextDecoder,this.data=new Uint8Array(0),this.objectLevel=0,this.onDoc=void 0}async write(t){if(t){let d=new Uint8Array(this.data.length+t.length);d.set(this.data,0),d.set(t,this.data.length),this.data=d}let r=0+this.objectLevel,n=-1,a=-1,o=!1,l=!1;for(let d=0;d<this.data.length;d++)if(this.data[d]===34&&!l&&(o=!o),l=o&&this.data[d]===92,!o&&(this.data[d]===123&&(r++,r===2&&(n=d)),this.data[d]===125)){if(r===2){let p=this.decoder.decode(this.data.slice(n,d+1)),b=JSON.parse(p);await this.onDoc(b),n=-1,a=d+1}r--}a>-1?(this.data=this.data.slice(a),this.objectLevel=1):n>-1&&(this.data=this.data.slice(n),this.objectLevel=1)}};var Ko=(e,t)=>{let r=atob(e),n=r.length,a=new Uint8Array(n);for(let o=0;o<n;++o)a[o]=r.charCodeAt(o);return new Blob([a],{type:t})},Zo=e=>new Promise((t,r)=>{let n=new FileReader;n.onloadend=()=>{let a=`data:${e.type};base64,`,o=n.result.slice(a.length);t(o)},n.readAsDataURL(e)}),cr=class extends j{constructor(t,{since:r,limit:n}){let a;super({async start(o){a=(await t.getChanges(r,{limit:n})).body.getReader()},async pull(o){let{done:l,value:d}=await a.read();l?(o.close(),a.releaseLock()):o.enqueue(d)}},{highWaterMark:1024*1024})}},Xo=e=>{for(let t=0;t<e.length;t++)if(e[t]===10)return t;return-1},hr=class extends I{constructor(t={}){t.numberOfChanges=0,t.lastSeq=null;let r=new TextDecoder;super({transform(n,a){let o=new Uint8Array(this.data.length+n.length);for(o.set(this.data,0),o.set(n,this.data.length),this.data=o;;){let l=Xo(this.data);if(l===-1)return;if(l>0){let d=r.decode(this.data.slice(0,l)),p;try{p=JSON.parse(d)}catch{throw new Error("could not parse change JSON")}let{last_seq:b,id:m,changes:v}=p;b?t.lastSeq=b:(t.numberOfChanges++,a.enqueue({id:m,revs:v}))}this.data=this.data.slice(l+1)}},data:new Uint8Array(0),startParsed:!1},{highWaterMark:1024*1024*8},{highWaterMark:1024})}},pr=class extends I{constructor(t){super({async transform(r,n){let a={};for(let{id:d,revs:p}of r)a[d]=p.map(({rev:b})=>b);let l=await(await t.revsDiff(a)).json();for(let d in l){if(!("missing"in l[d]))throw new Error("missing `missing` property in revsDiff response");let{missing:p}=l[d],b=p.map(m=>({rev:m}));b.length>0&&n.enqueue({id:d,revs:b})}}})}},br=class extends I{constructor(t,r){r.docsRead=0,super({async transform(n,a){if(n.length===0)return;let o=[],l={};for(let m of n){let{id:v,revs:_}=m;l[v]=m;for(let{rev:g}of _)o.push({id:v,rev:g})}if(o.length===0)throw new Error("received messages with empty revs");let p=(await t.bulkGet(o)).body.getReader(),b=new je;for(b.onDoc=async m=>{let{id:v,docs:_}=m;if(!(v in l))throw console.log(m),new Error("recived doc which we did not ask for");let g={};for(let{ok:R}of _)if(g[R._rev]=R,R._attachments)for(let w in R._attachments){let h=R._attachments[w],{data:c,content_type:i}=h;h.data=await Ko(c,i)}let E=l[v];for(let R of E.revs)R.rev in g&&(R.doc=g[R.rev]);a.enqueue(E),r.docsRead++};;){let{done:m,value:v}=await p.read();if(m)break;await b.write(v)}}},{highWaterMark:8},{highWaterMark:1024*4})}},mr=class extends K{constructor(t,r={}){r.docsWritten=0,super({async write(n){let a=n.reduce((o,{revs:l})=>o.concat(l.map(({doc:d})=>d)),[]);if(a.length>0){for(let l of a)if(l._attachments)for(let d in l._attachments){let p=l._attachments[d],{data:b}=p;p.data=await Zo(b)}let o=await t.bulkDocs(a)}r.docsWritten+=n.length}})}},Ie=class extends se{constructor(t){super(),this.adapter=t}async getInfo(){let[{uuid:t},{update_seq:r}]=await Promise.all([this.adapter.getServerInfo(),this.adapter.getInfo()]);return{uuid:t,updateSeq:r}}async getLog(t){let r=`_local/${t}`,n;try{n=await(await this.adapter.getDoc(r)).json()}catch{n={_id:r}}return n}async saveLog(t){return(await this.adapter.saveDoc(t)).json()}getChanges(t,{limit:r}={},n={}){let a=new cr(this.adapter,{since:t,limit:r}),o=new hr(n);return a.pipeThrough(o)}getDiff(){return new pr(this.adapter)}getRevs(t={}){return new br(this.adapter,t)}saveRevs(t={}){return new mr(this.adapter,t)}};var gt=class extends ie{constructor({url:t,headers:r}){super(),this.adapter=new Be({url:t,headers:r}),this.replicator=new Ie(this.adapter)}async getDoc(t){return(await this.adapter.getDoc(t)).json()}async saveDoc(t){let r=await this.adapter.saveDoc(t);return this.dispatchEvent(new Event("change")),r.json()}async deleteDoc(t){let r=await this.adapter.deleteDoc(t);return this.dispatchEvent(new Event("change")),r.json()}};export{gt as HttpDatabase,yt as IndexedDBDatabase};
