var Fe=Object.create;var Te=Object.defineProperty;var Ne=Object.getOwnPropertyDescriptor;var Ve=Object.getOwnPropertyNames;var Je=Object.getPrototypeOf,ze=Object.prototype.hasOwnProperty;var He=(h,e)=>()=>(e||h((e={exports:{}}).exports,e),e.exports);var Ke=(h,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Ve(e))!ze.call(h,a)&&a!==s&&Te(h,a,{get:()=>e[a],enumerable:!(n=Ne(e,a))||n.enumerable});return h};var ie=(h,e,s)=>(s=h!=null?Fe(Je(h)):{},Ke(e||!h||!h.__esModule?Te(s,"default",{value:h,enumerable:!0}):s,h));var te=He((De,xe)=>{(function(h){if(typeof De=="object")xe.exports=h();else if(typeof define=="function"&&define.amd)define(h);else{var e;try{e=window}catch{e=self}e.SparkMD5=h()}})(function(h){"use strict";var e=function(d,c){return d+c&4294967295},s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(d,c,t,r,i,o){return c=e(e(c,d),e(r,o)),e(c<<i|c>>>32-i,t)}function a(d,c){var t=d[0],r=d[1],i=d[2],o=d[3];t+=(r&i|~r&o)+c[0]-680876936|0,t=(t<<7|t>>>25)+r|0,o+=(t&r|~t&i)+c[1]-389564586|0,o=(o<<12|o>>>20)+t|0,i+=(o&t|~o&r)+c[2]+606105819|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&t)+c[3]-1044525330|0,r=(r<<22|r>>>10)+i|0,t+=(r&i|~r&o)+c[4]-176418897|0,t=(t<<7|t>>>25)+r|0,o+=(t&r|~t&i)+c[5]+1200080426|0,o=(o<<12|o>>>20)+t|0,i+=(o&t|~o&r)+c[6]-1473231341|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&t)+c[7]-45705983|0,r=(r<<22|r>>>10)+i|0,t+=(r&i|~r&o)+c[8]+1770035416|0,t=(t<<7|t>>>25)+r|0,o+=(t&r|~t&i)+c[9]-1958414417|0,o=(o<<12|o>>>20)+t|0,i+=(o&t|~o&r)+c[10]-42063|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&t)+c[11]-1990404162|0,r=(r<<22|r>>>10)+i|0,t+=(r&i|~r&o)+c[12]+1804603682|0,t=(t<<7|t>>>25)+r|0,o+=(t&r|~t&i)+c[13]-40341101|0,o=(o<<12|o>>>20)+t|0,i+=(o&t|~o&r)+c[14]-1502002290|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&t)+c[15]+1236535329|0,r=(r<<22|r>>>10)+i|0,t+=(r&o|i&~o)+c[1]-165796510|0,t=(t<<5|t>>>27)+r|0,o+=(t&i|r&~i)+c[6]-1069501632|0,o=(o<<9|o>>>23)+t|0,i+=(o&r|t&~r)+c[11]+643717713|0,i=(i<<14|i>>>18)+o|0,r+=(i&t|o&~t)+c[0]-373897302|0,r=(r<<20|r>>>12)+i|0,t+=(r&o|i&~o)+c[5]-701558691|0,t=(t<<5|t>>>27)+r|0,o+=(t&i|r&~i)+c[10]+38016083|0,o=(o<<9|o>>>23)+t|0,i+=(o&r|t&~r)+c[15]-660478335|0,i=(i<<14|i>>>18)+o|0,r+=(i&t|o&~t)+c[4]-405537848|0,r=(r<<20|r>>>12)+i|0,t+=(r&o|i&~o)+c[9]+568446438|0,t=(t<<5|t>>>27)+r|0,o+=(t&i|r&~i)+c[14]-1019803690|0,o=(o<<9|o>>>23)+t|0,i+=(o&r|t&~r)+c[3]-187363961|0,i=(i<<14|i>>>18)+o|0,r+=(i&t|o&~t)+c[8]+1163531501|0,r=(r<<20|r>>>12)+i|0,t+=(r&o|i&~o)+c[13]-1444681467|0,t=(t<<5|t>>>27)+r|0,o+=(t&i|r&~i)+c[2]-51403784|0,o=(o<<9|o>>>23)+t|0,i+=(o&r|t&~r)+c[7]+1735328473|0,i=(i<<14|i>>>18)+o|0,r+=(i&t|o&~t)+c[12]-1926607734|0,r=(r<<20|r>>>12)+i|0,t+=(r^i^o)+c[5]-378558|0,t=(t<<4|t>>>28)+r|0,o+=(t^r^i)+c[8]-2022574463|0,o=(o<<11|o>>>21)+t|0,i+=(o^t^r)+c[11]+1839030562|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^t)+c[14]-35309556|0,r=(r<<23|r>>>9)+i|0,t+=(r^i^o)+c[1]-1530992060|0,t=(t<<4|t>>>28)+r|0,o+=(t^r^i)+c[4]+1272893353|0,o=(o<<11|o>>>21)+t|0,i+=(o^t^r)+c[7]-155497632|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^t)+c[10]-1094730640|0,r=(r<<23|r>>>9)+i|0,t+=(r^i^o)+c[13]+681279174|0,t=(t<<4|t>>>28)+r|0,o+=(t^r^i)+c[0]-358537222|0,o=(o<<11|o>>>21)+t|0,i+=(o^t^r)+c[3]-722521979|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^t)+c[6]+76029189|0,r=(r<<23|r>>>9)+i|0,t+=(r^i^o)+c[9]-640364487|0,t=(t<<4|t>>>28)+r|0,o+=(t^r^i)+c[12]-421815835|0,o=(o<<11|o>>>21)+t|0,i+=(o^t^r)+c[15]+530742520|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^t)+c[2]-995338651|0,r=(r<<23|r>>>9)+i|0,t+=(i^(r|~o))+c[0]-198630844|0,t=(t<<6|t>>>26)+r|0,o+=(r^(t|~i))+c[7]+1126891415|0,o=(o<<10|o>>>22)+t|0,i+=(t^(o|~r))+c[14]-1416354905|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~t))+c[5]-57434055|0,r=(r<<21|r>>>11)+i|0,t+=(i^(r|~o))+c[12]+1700485571|0,t=(t<<6|t>>>26)+r|0,o+=(r^(t|~i))+c[3]-1894986606|0,o=(o<<10|o>>>22)+t|0,i+=(t^(o|~r))+c[10]-1051523|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~t))+c[1]-2054922799|0,r=(r<<21|r>>>11)+i|0,t+=(i^(r|~o))+c[8]+1873313359|0,t=(t<<6|t>>>26)+r|0,o+=(r^(t|~i))+c[15]-30611744|0,o=(o<<10|o>>>22)+t|0,i+=(t^(o|~r))+c[6]-1560198380|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~t))+c[13]+1309151649|0,r=(r<<21|r>>>11)+i|0,t+=(i^(r|~o))+c[4]-145523070|0,t=(t<<6|t>>>26)+r|0,o+=(r^(t|~i))+c[11]-1120210379|0,o=(o<<10|o>>>22)+t|0,i+=(t^(o|~r))+c[2]+718787259|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~t))+c[9]-343485551|0,r=(r<<21|r>>>11)+i|0,d[0]=t+d[0]|0,d[1]=r+d[1]|0,d[2]=i+d[2]|0,d[3]=o+d[3]|0}function u(d){var c=[],t;for(t=0;t<64;t+=4)c[t>>2]=d.charCodeAt(t)+(d.charCodeAt(t+1)<<8)+(d.charCodeAt(t+2)<<16)+(d.charCodeAt(t+3)<<24);return c}function l(d){var c=[],t;for(t=0;t<64;t+=4)c[t>>2]=d[t]+(d[t+1]<<8)+(d[t+2]<<16)+(d[t+3]<<24);return c}function f(d){var c=d.length,t=[1732584193,-271733879,-1732584194,271733878],r,i,o,T,D,R;for(r=64;r<=c;r+=64)a(t,u(d.substring(r-64,r)));for(d=d.substring(r-64),i=d.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=d.charCodeAt(r)<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(a(t,o),r=0;r<16;r+=1)o[r]=0;return T=c*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),D=parseInt(T[2],16),R=parseInt(T[1],16)||0,o[14]=D,o[15]=R,a(t,o),t}function p(d){var c=d.length,t=[1732584193,-271733879,-1732584194,271733878],r,i,o,T,D,R;for(r=64;r<=c;r+=64)a(t,l(d.subarray(r-64,r)));for(d=r-64<c?d.subarray(r-64):new Uint8Array(0),i=d.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=d[r]<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(a(t,o),r=0;r<16;r+=1)o[r]=0;return T=c*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),D=parseInt(T[2],16),R=parseInt(T[1],16)||0,o[14]=D,o[15]=R,a(t,o),t}function g(d){var c="",t;for(t=0;t<4;t+=1)c+=s[d>>t*8+4&15]+s[d>>t*8&15];return c}function v(d){var c;for(c=0;c<d.length;c+=1)d[c]=g(d[c]);return d.join("")}v(f("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(e=function(d,c){var t=(d&65535)+(c&65535),r=(d>>16)+(c>>16)+(t>>16);return r<<16|t&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function d(c,t){return c=c|0||0,c<0?Math.max(c+t,0):Math.min(c,t)}ArrayBuffer.prototype.slice=function(c,t){var r=this.byteLength,i=d(c,r),o=r,T,D,R,E;return t!==h&&(o=d(t,r)),i>o?new ArrayBuffer(0):(T=o-i,D=new ArrayBuffer(T),R=new Uint8Array(D),E=new Uint8Array(this,i,T),R.set(E),D)}}();function m(d){return/[\u0080-\uFFFF]/.test(d)&&(d=unescape(encodeURIComponent(d))),d}function b(d,c){var t=d.length,r=new ArrayBuffer(t),i=new Uint8Array(r),o;for(o=0;o<t;o+=1)i[o]=d.charCodeAt(o);return c?i:r}function y(d){return String.fromCharCode.apply(null,new Uint8Array(d))}function S(d,c,t){var r=new Uint8Array(d.byteLength+c.byteLength);return r.set(new Uint8Array(d)),r.set(new Uint8Array(c),d.byteLength),t?r:r.buffer}function _(d){var c=[],t=d.length,r;for(r=0;r<t-1;r+=2)c.push(parseInt(d.substr(r,2),16));return String.fromCharCode.apply(String,c)}function w(){this.reset()}return w.prototype.append=function(d){return this.appendBinary(m(d)),this},w.prototype.appendBinary=function(d){this._buff+=d,this._length+=d.length;var c=this._buff.length,t;for(t=64;t<=c;t+=64)a(this._hash,u(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},w.prototype.end=function(d){var c=this._buff,t=c.length,r,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o;for(r=0;r<t;r+=1)i[r>>2]|=c.charCodeAt(r)<<(r%4<<3);return this._finish(i,t),o=v(this._hash),d&&(o=_(o)),this.reset(),o},w.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},w.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},w.prototype.setState=function(d){return this._buff=d.buff,this._length=d.length,this._hash=d.hash,this},w.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},w.prototype._finish=function(d,c){var t=c,r,i,o;if(d[t>>2]|=128<<(t%4<<3),t>55)for(a(this._hash,d),t=0;t<16;t+=1)d[t]=0;r=this._length*8,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),o=parseInt(r[1],16)||0,d[14]=i,d[15]=o,a(this._hash,d)},w.hash=function(d,c){return w.hashBinary(m(d),c)},w.hashBinary=function(d,c){var t=f(d),r=v(t);return c?_(r):r},w.ArrayBuffer=function(){this.reset()},w.ArrayBuffer.prototype.append=function(d){var c=S(this._buff.buffer,d,!0),t=c.length,r;for(this._length+=d.byteLength,r=64;r<=t;r+=64)a(this._hash,l(c.subarray(r-64,r)));return this._buff=r-64<t?new Uint8Array(c.buffer.slice(r-64)):new Uint8Array(0),this},w.ArrayBuffer.prototype.end=function(d){var c=this._buff,t=c.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i,o;for(i=0;i<t;i+=1)r[i>>2]|=c[i]<<(i%4<<3);return this._finish(r,t),o=v(this._hash),d&&(o=_(o)),this.reset(),o},w.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},w.ArrayBuffer.prototype.getState=function(){var d=w.prototype.getState.call(this);return d.buff=y(d.buff),d},w.ArrayBuffer.prototype.setState=function(d){return d.buff=b(d.buff,!0),w.prototype.setState.call(this,d)},w.ArrayBuffer.prototype.destroy=w.prototype.destroy,w.ArrayBuffer.prototype._finish=w.prototype._finish,w.ArrayBuffer.hash=function(d,c){var t=p(new Uint8Array(d)),r=v(t);return c?_(r):r},w})});var Le=ie(te(),1);var Ce=ie(te(),1),Qe=32768,qe=async h=>{let e=Math.min(Qe,h.size),s=Math.ceil(h.size/e),n=new Ce.default.ArrayBuffer;for(let a=0;a<s;a++){let l=await h.slice(a*e,(a+1)*e).arrayBuffer();n.append(l)}return n.end(!0)},W=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,h=>(h^crypto.getRandomValues(new Uint8Array(1))[0]&15>>h/4).toString(16));var Ie=(h,e)=>{let s=new DecompressionStream("gzip"),n=h.stream().pipeThrough(s),a={headers:{"Content-Type":e}};return new Response(n,a).blob()};var Ze=async(h,e)=>Le.default.hash(`${h}${e}`),Ge=(h,e)=>h.sessionId&&h.sessionId===e.sessionId&&h.sourceLastSeq&&h.sourceLastSeq===e.sourceLastSeq?h.sourceLastSeq:null,Ae=(h,e)=>{if(!h)return-1;if(!e)return 1;if(h===e)return 0;let s=parseInt(h,10),n=parseInt(e,10);return s-n},M=class extends TransformStream{constructor({batchSize:e}){super({transform(s,n){if(this.entries.push(s),this.entries.length>=e){let a=this.entries.splice(0,e);n.enqueue(a)}},flush(s){this.entries.length>0&&s.enqueue(this.entries)},entries:[]},{highWaterMark:1024*4},{highWaterMark:1024*4})}},O=class extends TransformStream{constructor(e){super({transform(s,n){console.debug(e,s),n.enqueue(s)}},{highWaterMark:1024*4},{highWaterMark:1024*4})}};async function re(h,e,{batchSize:s={getChanges:1024,getDiff:512,getRevs:1024,saveRevs:128}}={}){let n=W(),a={docsRead:0,docsWritten:0},[{uuid:u},{uuid:l,updateSeq:f}]=await Promise.all([e.replicator.getInfo(),h.replicator.getInfo()]),p=await Ze(u,l),[g,v]=await Promise.all([e.replicator.getLog(p),h.replicator.getLog(p)]),m=Ge(g,v);if(Ae(m,f)===0)return a;let b=!1;for(;!b;){let y={};if(await h.replicator.getChanges(m,{limit:s.getChanges},y).pipeThrough(new O("getChanges")).pipeThrough(new M({batchSize:s.getDiff})).pipeThrough(e.replicator.getDiff()).pipeThrough(new O("getDiff")).pipeThrough(new M({batchSize:s.getRevs})).pipeThrough(h.replicator.getRevs(y)).pipeThrough(new O("getRevs")).pipeThrough(new M({batchSize:s.saveRevs})).pipeTo(e.replicator.saveRevs(y)),a.lastSeq=y.lastSeq,a.docsRead+=y.docsRead,a.docsWritten+=y.docsWritten,y.lastSeq!==m){v.sessionId=n,v.sourceLastSeq=y.lastSeq,g.sessionId=n,g.sourceLastSeq=y.lastSeq;let[{rev:S},{rev:_}]=await Promise.all([e.replicator.saveLog(g),h.replicator.saveLog(v)]);g._rev=S,v._rev=_}m=y.lastSeq,b=y.numberOfChanges<s.getChanges||Ae(y.lastSeq,f)>=0}return a}var I=class extends EventTarget{async init(){throw new Error(`init is not implemented for ${this.constructor.name}`)}async destroy(){throw new Error(`destroy is not implemented for ${this.constructor.name}`)}async getChanges(e){throw new Error(`getChanges is not implemented for ${this.constructor.name}`)}async getDoc(e){throw new Error(`getDoc is not implemented for ${this.constructor.name}`)}async saveDoc(e){throw new Error(`saveDoc is not implemented for ${this.constructor.name}`)}async deleteDoc(e){throw new Error(`deleteDoc is not implemented for ${this.constructor.name}`)}async getDocs(e){throw new Error(`getDocs is not implemented for ${this.constructor.name}`)}async pull(e){let s=await re(e,this);return s.docsWritten>0&&this.dispatchEvent(new Event("change")),s}push(e){return re(this,e)}sync(e){return Promise.all([this.pull(e),this.push(e)])}};function F(h){for(var e,s,n,a=h.rev_tree.slice(),u;u=a.pop();){var l=u.ids,f=l[2],p=u.pos;if(f.length){for(var g=0,v=f.length;g<v;g++)a.push({pos:p+1,ids:f[g]});continue}var m=!!l[1].deleted,b=l[0];(!e||(n!==m?n:s!==p?s<p:e<b))&&(e=b,s=p,n=m)}return s+"-"+e}function $e(h,e){for(var s=h.slice(),n;n=s.pop();)for(var a=n.pos,u=n.ids,l=u[2],f=e(l.length===0,a,u[0],n.ctx,u[1]),p=0,g=l.length;p<g;p++)s.push({pos:a+1,ids:l[p],ctx:f})}function ce(h){var e=[];return $e(h.rev_tree,function(s,n,a,u,l){l.status==="available"&&!s&&(e.push(n+"-"+a),l.status="missing")}),e}function Xe(h){for(var e=[],s=h.slice(),n;n=s.pop();){var a=n.pos,u=n.ids,l=u[0],f=u[1],p=u[2],g=p.length===0,v=n.history?n.history.slice():[];v.push({id:l,opts:f}),g&&e.push({pos:a+1-v.length,ids:v});for(var m=0,b=p.length;m<b;m++)s.push({pos:a+1,ids:p[m],history:v})}return e.reverse()}function Ye(h,e){return h.pos-e.pos}function ke(h,e,s){for(var n=0,a=h.length,u;n<a;)u=n+a>>>1,s(h[u],e)<0?n=u+1:a=u;return n}function et(h,e,s){var n=ke(h,e,s);h.splice(n,0,e)}function Pe(h,e){for(var s,n,a=e,u=h.length;a<u;a++){var l=h[a],f=[l.id,l.opts,[]];n?(n[2].push(f),n=f):s=n=f}return s}function tt(h,e){return h[0]<e[0]?-1:1}function Be(h,e){for(var s=[{tree1:h,tree2:e}],n=!1;s.length>0;){var a=s.pop(),u=a.tree1,l=a.tree2;(u[1].status||l[1].status)&&(u[1].status=u[1].status==="available"||l[1].status==="available"?"available":"missing");for(var f=0;f<l[2].length;f++){if(!u[2][0]){n="new_leaf",u[2][0]=l[2][f];continue}for(var p=!1,g=0;g<u[2].length;g++)u[2][g][0]===l[2][f][0]&&(s.push({tree1:u[2][g],tree2:l[2][f]}),p=!0);p||(n="new_branch",et(u[2],l[2][f],tt))}}return{conflicts:n,tree:h}}function je(h,e,s){var n=[],a=!1,u=!1,l;if(!h.length)return{tree:[e],conflicts:"new_leaf"};for(var f=0,p=h.length;f<p;f++){var g=h[f];if(g.pos===e.pos&&g.ids[0]===e.ids[0])l=Be(g.ids,e.ids),n.push({pos:g.pos,ids:l.tree}),a=a||l.conflicts,u=!0;else if(s!==!0){var v=g.pos<e.pos?g:e,m=g.pos<e.pos?e:g,b=m.pos-v.pos,y=[],S=[];for(S.push({ids:v.ids,diff:b,parent:null,parentIdx:null});S.length>0;){var _=S.pop();if(_.diff===0){_.ids[0]===m.ids[0]&&y.push(_);continue}for(var w=_.ids[2],d=0,c=w.length;d<c;d++)S.push({ids:w[d],diff:_.diff-1,parent:_.ids,parentIdx:d})}var t=y[0];t?(l=Be(t.ids,m.ids),t.parent[2][t.parentIdx]=l.tree,n.push({pos:v.pos,ids:v.ids}),a=a||l.conflicts,u=!0):n.push(g)}else n.push(g)}return u||n.push(e),n.sort(Ye),{tree:n,conflicts:a||"internal_node"}}function rt(h,e){for(var s=Xe(h),n,a,u=0,l=s.length;u<l;u++){var f=s[u],p=f.ids,g;if(p.length>e){n||(n={});var v=p.length-e;g={pos:f.pos+v,ids:Pe(p,v)};for(var m=0;m<v;m++){var b=f.pos+m+"-"+p[m].id;n[b]=!0}}else g={pos:f.pos,ids:Pe(p,0)};a?a=je(a,g,!0).tree:a=[g]}return n&&$e(a,function(y,S,_){delete n[S+"-"+_]}),{tree:a,revs:n?Object.keys(n):[]}}function N(h,e,s){var n=je(h,e),a=rt(n.tree,s);return{tree:a.tree,stemmedRevs:a.revs,conflicts:n.conflicts}}var Me=ie(te(),1);var A="docs",$="meta",Ue=1e3,ue={status:"available"},We={status:"missing"},st=h=>Me.default.hash(JSON.stringify(h)),nt=h=>{let[e,s]=h.split("-");return[parseInt(e,10),s]},ot=async h=>`md5-${await qe(h)}`,V=class{constructor({name:e}){this.name=e,this.db=null,this.metadata=null}async init(){if(!this.db)return new Promise((e,s)=>{let n=indexedDB.open(this.name);n.onupgradeneeded=a=>{let u=a.target.result,l="id";u.createObjectStore(A,{keyPath:l}).createIndex("seq","seq",{unique:!0}),u.createObjectStore($,{keyPath:l})},n.onsuccess=a=>{this.db=a.target.result,this.db.onabort=()=>this.db.close(),this.db.onversionchange=()=>this.db.close();let u=this.db.transaction($,"readwrite");u.oncomplete=()=>e();let l=u.objectStore($);l.get($).onsuccess=f=>{this.metadata=f.target.result||{id:$};let p=!1;"doc_count"in this.metadata||(p=!0,this.metadata.doc_count=0),"seq"in this.metadata||(p=!0,this.metadata.seq=0),"db_uuid"in this.metadata||(p=!0,this.metadata.db_uuid=W()),p&&l.put(this.metadata)}},n.onerror=a=>s(a.target.error),n.onblocked=a=>s(a)})}destroy(){return new Promise((e,s)=>{this.db.close();let n=indexedDB.deleteDatabase(this.name);n.onsuccess=()=>{this.db=null,this.metadata=null,e()}})}getLocalDoc(e){let s=`_local/${e}`;return new Promise((n,a)=>{this.db.transaction(A,"readonly").objectStore(A).get(s).onsuccess=u=>{let l=u.target.result,f=l?l.data:{_id:s};n(f)}})}saveLocalDoc(e){return e._rev=e._rev?e._rev+1:1,new Promise((s,n)=>{let a={id:e._id,data:e};this.db.transaction(A,"readwrite").objectStore(A).put(a).onsuccess=()=>s({rev:e._rev})})}getEntries(e){return new Promise((s,n)=>{let a=this.db.transaction(A,"readonly").objectStore(A),u={},l=e.length;for(let f of e)a.get(f).onsuccess=p=>{u[f]=p.target.result,l--,l===0&&s(u)}})}async getRevs(e){let s=e.map(({id:a})=>a),n=await this.getEntries(s);for(let{id:a,revs:u}of e){let l=n[a];if(!!l){rev.entry=l;for(let f of u){let p=l.revs[f.rev];if(!p)continue;let{rev_tree:[{pos:g,ids:v}]}=l,m={start:g-1,ids:[]},[b,y,S]=v;for(;S;){m.start+=1,m.ids.unshift(b);let d=S[0]||[];b=d[0],y=d[1],S=d[2]}let{data:_,deleted:w}=p;f.doc={..._,_id:a,_rev:f.rev,_deleted:w,_revisions:m}}}}return e}async buildEntriesWithNewEdits(e){let s=[];for(let{id:n,revs:a,entry:u}of e){let l=++this.metadata.seq,f={id:n,seq:l};for(let{doc:g}of a){let{_id:v,_rev:m,_deleted:b,_attachments:y,_revisions:S}=g,_=S.start-S.ids.length+1,w=[S.ids[0],ue,[]];for(let C=1,L=S.ids.length;C<L;C++)w=[S.ids[C],We,[w]];let d=[{pos:_,ids:w}],c=u?u.rev_tree:[],{tree:t,stemmedRevs:r}=N(c,d[0],Ue),i=F({rev_tree:t}),o=parseInt(i,10),T=u?u.attachments:{};if(y)for(let C in y){let L=y[C],{content_type:U,data:Oe}=L,Ee=L.digest;L.digest=Ee,L.revpos=o,T[Ee]={data:Oe,revs:{[i]:!0}}}let D={};for(let C in g)C.startsWith("_")||(D[C]=g[C]);if(g._attachments){D._attachments={};for(let C in g._attachments){let{digest:L,revpos:U}=g._attachments[C];D._attachments[C]={digest:L,revpos:U}}}let E={...u?u.revs:null,[m]:{data:D,deleted:!!b}},q=ce({rev_tree:t}).concat(r);for(let C of q)delete E[C];let B=E[i].deleted;f.attachments=T,f.deleted=B,f.rev=i,f.rev_tree=t,f.revs=E}let p;u?u.deleted?p=f.deleted?0:1:p=f.deleted?-1:0:p=f.deleted?0:1,this.metadata.doc_count+=p,s.push(f)}return s}async buildEntries(e){let s=[];for(let{doc:n,existingEntry:a}of e){let u=++this.metadata.seq,{_id:l,_rev:f,_deleted:p,_attachments:g}=n,v={};for(let x in n)x.startsWith("_")||(v[x]=n[x]);if(n._attachments){v._attachments={};for(let x in n._attachments){let{digest:q,revpos:B}=n._attachments[x];v._attachments[x]={digest:q,revpos:B}}}let m=await st({...v,_id:l,_rev:f,_deleted:p}),b,y;if(f){let[x,q]=nt(n._rev);y=x+1,b=[{pos:x,ids:[q,We,[[m,ue,[]]]]}]}else y=1,b=[{pos:1,ids:[m,ue,[]]}];let S=a?a.rev_tree:[],{tree:_,stemmedRevs:w}=N(S,b[0],Ue),d=F({rev_tree:_}),c=parseInt(d,10),t=a?a.attachments:{};if(g)for(let x in g){let q=g[x],{content_type:B,data:C,stub:L}=q;if(L){t[U].revs[d]=!0;continue}let U=await ot(C);q.digest=U,q.revpos=c,t[U]={data:C,revs:{[d]:!0}}}n._rev=`${y}-${m}`;let i={...a?a.revs:null,[n._rev]:{data:v,deleted:!!p}},o=i[d].deleted,T={attachments:t,deleted:o,id:l,rev:d,rev_tree:_,revs:i,seq:u},R=ce({rev_tree:_}).concat(w);for(let x of R)delete T.revs[x];let E;a?a.deleted?E=o?0:1:E=o?-1:0:E=o?0:1,this.metadata.doc_count+=E,s.push(T)}return s}async saveEntries(e){return new Promise((s,n)=>{let a=this.db.transaction([A,$],"readwrite"),u=a.objectStore(A),l=a.objectStore($),f=0,p=e.length;for(let g of e)u.put(g).onsuccess=()=>{f++,p--,p===0&&(l.put(this.metadata).onsuccess=()=>s(f))}})}async saveRevsWithEntries(e){let s=await this.buildEntriesWithNewEdits(e);return this.saveEntries(s)}async saveDocs(e){let s=e.map(({_id:l})=>l),n=await this.getEntries(s),a=e.map(l=>({doc:l,entry:n[l._id]})),u=await this.buildEntries(a);return await this.saveEntries(u),u.map(({id:l,rev:f})=>({ok:!0,id:l,rev:f}))}async getChanges({since:e,limit:s}={}){return e=e||-1,s=s||-1,new Promise((n,a)=>{let u=this.db.transaction(A,"readonly"),f=u.objectStore(A).index("seq").openCursor(IDBKeyRange.lowerBound(e,!0)),p=[],g=-1,v=0;f.onsuccess=m=>{if(!m.target.result)return;let b=m.target.result,y=b.value,{id:S,rev:_,seq:w,deleted:d}=y,c={seq:w,id:S,changes:[{rev:_}],deleted:d};p.push(c),g=w,v++,v!==s&&b.continue()},u.oncomplete=()=>n({changes:p,lastSeq:g})})}};var P=class{async getInfo(){throw new Error(`getInfo is not implemented for ${this.constructor.name}`)}async getLog(e){throw new Error(`getLog is not implemented for ${this.constructor.name}`)}async saveLog(e){throw new Error(`saveLog is not implemented for ${this.constructor.name}`)}getChanges(e,{limit:s}={},n={}){throw new Error(`getChanges is not implemented for ${this.constructor.name}`)}getDiff(){throw new Error(`getDiff is not implemented for ${this.constructor.name}`)}getRevs(e={}){throw new Error(`getRevs is not implemented for ${this.constructor.name}`)}saveRevs(e={}){throw new Error(`saveRevs is not implemented for ${this.constructor.name}`)}};var de=class extends ReadableStream{constructor(e,{since:s,limit:n},a={}){let u;super({async start(l){let f=await e.getChanges({since:s,limit:n});u=f.changes,a.numberOfChanges=u.length,a.lastSeq=f.lastSeq},pull(l){if(u.length===0){l.close();return}let{id:f,changes:p,deleted:g}=u.shift();l.enqueue({id:f,revs:p,deleted:g})}})}},he=class extends TransformStream{constructor(e){super({async transform(s,n){let a=s.map(({id:l})=>l),u=await e.getEntries(a);for(let{id:l,revs:f}of s){let p=u[l];if(p){let g=f.filter(({rev:v})=>!(v in p.revs));g.length>0&&n.enqueue({id:l,revs:g,entry:p})}else n.enqueue({id:l,revs:f})}}},{highWaterMark:8},{highWaterMark:1024})}},le=class extends TransformStream{constructor(e,s){s.docsRead=0,super({async transform(n,a){if(n.length===0)return;let u=await e.getRevs(n);for(let l of u)s.docsRead++,a.enqueue(l)}},{highWaterMark:8})}},fe=class extends WritableStream{constructor(e,s={}){s.docsWritten=0,super({async write(n){s.docsWritten+=await e.saveRevsWithEntries(n)}},{highWaterMark:1024*4})}},j=class extends P{constructor(e){super(),this.adapter=e}getInfo(){let{db_uuid:e,seq:s}=this.adapter.metadata;return{uuid:e,updateSeq:s}}getLog(e){return this.adapter.getLocalDoc(e)}saveLog(e){return this.adapter.saveLocalDoc(e)}getChanges(e,{limit:s}={},n={}){return new de(this.adapter,{since:e,limit:s},n)}getDiff(){return new he(this.adapter)}getRevs(e={}){return new le(this.adapter,e)}saveRevs(e={}){return new fe(this.adapter,e)}};var se=class extends I{constructor({name:e}){super(),this.name=e,this.adapter=new V({name:e}),this.replicator=new j(this.adapter)}init(){return this.adapter.init()}destroy(){return this.adapter.destroy()}async saveDoc(e){let[s]=await this.adapter.saveDocs([e]);return this.dispatchEvent(new Event("change")),s}};var pe="seqs",J="docs",z="local-docs",ge="revs",ve="atts",H="meta",at=1e3,it={status:"available"},ct={status:"missing"},K=class{constructor({name:e}){this.name=e,this.db=null,this.metadata=null}async init(){if(!this.db)return new Promise((e,s)=>{let n=indexedDB.open(this.name);n.onupgradeneeded=a=>{let u=a.target.result;u.createObjectStore(pe,{autoIncrement:!0}),u.createObjectStore(J,{keyPath:"id"}),u.createObjectStore(z,{keyPath:"id"}),u.createObjectStore(ge,{keyPath:["id","rev"]}),u.createObjectStore(ve,{keyPath:["id","name","digest"]}),u.createObjectStore(H,{keyPath:"id"})},n.onsuccess=a=>{this.db=a.target.result,this.db.onabort=()=>this.db.close(),this.db.onversionchange=()=>this.db.close();let u=this.db.transaction(H,"readwrite");u.oncomplete=()=>e();let l=u.objectStore(H);l.get(H).onsuccess=f=>{this.metadata=f.target.result||{id:H},"uuid"in this.metadata||(this.metadata.uuid=W(),l.put(this.metadata))}},n.onerror=a=>s(a.target.error),n.onblocked=a=>s(a)})}destroy(){return new Promise((e,s)=>{this.db.close();let n=indexedDB.deleteDatabase(this.name);n.onsuccess=()=>{this.db=null,this.metadata=null,e()}})}getLocalDoc(e){let s=`_local/${e}`;return new Promise((n,a)=>{this.db.transaction(z,"readonly").objectStore(z).get(s).onsuccess=u=>{let l=u.target.result,f=l?l.data:{_id:s};n(f)}})}saveLocalDoc(e){return e._rev=e._rev?e._rev+1:1,new Promise((s,n)=>{let a={id:e._id,data:e};this.db.transaction(z,"readwrite").objectStore(z).put(a).onsuccess=()=>s({rev:e._rev})})}getEntries(e){return new Promise((s,n)=>{let a=this.db.transaction(J,"readonly").objectStore(J),u={},l=e.length;for(let f of e)a.get(f).onsuccess=p=>{u[f]=p.target.result,l--,l===0&&s(u)}})}async buildEntries(e){let s=[];for(let{doc:n,existingEntry:a}of e){let{_id:u,_rev:l,_deleted:f,_attachments:p,_revisions:g}=n,v=g.start-g.ids.length+1,m=[g.ids[0],it,[]];for(let R=1,E=g.ids.length;R<E;R++)m=[g.ids[R],ct,[m]];let b=[{pos:v,ids:m}],y=a?a.rev_tree:[],{tree:S,stemmedRevs:_}=N(y,b[0],at),w=F({rev_tree:S}),d=parseInt(w,10),c=a?a.atts:[];if(p)for(let R in p){let E=p[R],{content_type:x,data:q}=E,B=E.digest;E.digest=B,E.revpos=d,c.push({id:u,name:R,digest:B,data:q})}let t={};for(let R in n)R.startsWith("_")||(t[R]=n[R]);if(n._attachments){t._attachments={};for(let R in n._attachments){let{digest:E,revpos:x}=n._attachments[R];t._attachments[R]={digest:E,revpos:x}}}let D={atts:c,rev:{id:u,rev:l,data:t},doc:{id:u,deleted:!!f,rev:w,tree:S},seq:{id:u,rev:l}};s.push(D)}return s}async saveEntries(e){return new Promise((s,n)=>{let a=this.db.transaction([ve,ge,J,pe],"readwrite"),u=a.objectStore(ve),l=a.objectStore(ge),f=a.objectStore(J),p=a.objectStore(pe),g=0,v=e.length;for(let{atts:m,rev:b,doc:y,seq:S}of e){let _=()=>{l.put(b).onsuccess=()=>{f.put(y).onsuccess=()=>{p.put(S).onsuccess=()=>{g++,v--,v===0&&s(g)}}}},w=m.length;if(w>0)for(let d of m)u.put(d).onsuccess=()=>{w--,w===0&&_()};else _()}})}async saveDocs(e){let s=await this.buildEntries(e);return this.saveEntries(s)}};var Q=class extends j{getInfo(){let{uuid:e}=this.adapter.metadata;return{uuid:e}}};var ne=class extends I{constructor({name:e}){super(),this.name=e,this.adapter=new K({name:e}),this.replicator=new Q(this.adapter)}init(){return this.adapter.init()}destroy(){return this.adapter.destroy()}};var Z=class{constructor({url:e,headers:s}){this.url=e,this.root=e.pathname,this.headers=s}async getServerInfo(){let e=new URL(this.url);e.pathname="/";let s=await fetch(e,{headers:this.headers});if(s.status!==200)throw new Error("Remote server not reachable");return s.json()}async getInfo(){let e=new URL(this.url),s=await fetch(e,{headers:this.headers});if(s.status!==200)throw new Error("Remote database not reachable");return s.json()}async getDoc(e){let s=new URL(`${this.root}/${e}`,this.url),n=await fetch(s,{headers:this.headers});if(n.status!==200)throw new Error("Could not get doc");return n}async saveDoc(e){let s=new URL(`${this.root}/${e._id}`,this.url),n=JSON.stringify(e),a=await fetch(s,{headers:{...this.headers,"Content-Type":"application/json"},method:"put",body:n});if(a.status!==201)throw new Error("Could not save doc");return a}async deleteDoc(e){let s=new URL(`${this.root}/${e._id}`,this.url);s.searchParams.set("rev",e._rev);let n=await fetch(s,{headers:{...this.headers},method:"delete"});if(n.status!==200)throw new Error("Could not delete doc");return n}async getChanges(e,{limit:s}={}){let n=new URL(`${this.root}/_changes`,this.url);n.searchParams.set("feed","continuous"),n.searchParams.set("timeout","0"),n.searchParams.set("style","all_docs"),e&&n.searchParams.set("since",e),s&&(n.searchParams.set("limit",s),n.searchParams.set("seq_interval",s));let a=await fetch(n,{headers:this.headers});if(a.status!==200)throw new Error("Could not get changes");return a}async revsDiff(e){let s=new URL(`${this.root}/_revs_diff`,this.url),n=JSON.stringify(e),a=await fetch(s,{headers:{...this.headers,"Content-Type":"application/json"},method:"post",body:n});if(a.status!==200)throw new Error("Could not get revs diff");return a}async bulkGet(e){let s=new URL(`${this.root}/_bulk_get`,this.url);s.searchParams.set("revs","true"),s.searchParams.set("attachments","true");let n=JSON.stringify({docs:e}),a=await fetch(s,{headers:{...this.headers,"Content-Type":"application/json",Accept:"multipart/related"},method:"post",body:n});if(a.status!==200)throw new Error("Could not get docs multipart");return a}async bulkDocs(e){let s=new URL(`${this.root}/_bulk_docs`,this.url),n=JSON.stringify({docs:e,new_edits:!1}),a=await fetch(s,{headers:{...this.headers,"Content-Type":"application/json"},method:"post",body:n});if(a.status!==201)throw new Error("Could not save bulk docs");return a}};function G(h,e,s=0){if(s>h.length+e.length+2)return-1;for(let n=s;n<h.length;n++)if(h[n]===45&&h[n+1]===45){let a,u;for(u=0;u<e.length;u++)if(a=!0,h[u+n+2]!==e[u]){a=!1;break}if(a)return n}return-1}function me(h,e=0){if(e>h.length+4)return-1;for(let s=e;s<h.length;s++)if(h[s]===13&&h[s+1]===10&&h[s+2]===13&&h[s+3]===10)return s;return-1}function we(h,e,s=0){if(s>h.length+e.length+4||h[s]!==45||h[s+1]!==45||h[s+e.length+2]!==45||h[s+e.length+3]!==45)return!1;for(let n=0;n<e.length;n++)if(h[n+s+2]!==e[n])return!1;return!0}var X=class{constructor(e){this.encoder=new TextEncoder,this.decoder=new TextDecoder;let s=this.parseContentType(e);this.id=s.id,this.boundaries=[s]}parseContentType(e){let[s,n,a]=e.match(/^([^;]+);\s*boundary="?([^="]+)"?/)||[];if(n!=="multipart/related")return;let u=this.encoder.encode(a);return{id:a,boundary:u}}parsePart(e){if(this.boundaries.length===0)return null;let{id:s,boundary:n}=this.boundaries[this.boundaries.length-1],a=G(e,n);if(a===-1)return null;let u=me(e,a);if(u===-1)return null;let l=e.slice(n.length+4,u),p=this.decoder.decode(l).split(`\r
`).reduce((d,c)=>{let[t,r]=c.split(/:\s*/);return d[t]=t==="Content-Length"?parseInt(r,10):r,d},{}),{"Content-Type":g}=p;if(!g)return null;let{"Content-Length":v}=p,m=v?G(e,n,v+u+6):G(e,n,u+4);if(m===-1||e.length<m)return null;let b=this.parseContentType(g);if(b)return this.boundaries.push(b),this.parsePart(e.slice(u+4));let y=we(e,n,m),S=y?m+n.length+6:m;y&&this.boundaries.pop();let _=e.slice(u+4,m-2),w=e.slice(S);return{boundary:this.id===s?null:s,headers:p,data:_,rest:w}}};var Y=class{constructor(e){this.parser=new X(e),this.data=new Uint8Array(0)}read(e){if(e){let a=new Uint8Array(this.data.length+e.length);a.set(this.data,0),a.set(e,this.data.length),this.data=a}let s=[],n;do if(n=this.parser.parsePart(this.data),n){let{boundary:a,headers:u,data:l,rest:f}=n;this.data=f,s.push({boundary:a,headers:u,data:l})}while(n);return s}};var ye=class extends ReadableStream{constructor(e,{since:s,limit:n}){let a;super({async start(u){a=(await e.getChanges(s,{limit:n})).body.getReader()},async pull(u){let{done:l,value:f}=await a.read();l?(u.close(),a.releaseLock()):u.enqueue(f)}},{highWaterMark:1024*1024})}},ut=h=>{for(let e=0;e<h.length;e++)if(h[e]===10)return e;return-1},_e=class extends TransformStream{constructor(e={}){e.numberOfChanges=0,e.lastSeq=null;let s=new TextDecoder;super({transform(n,a){let u=new Uint8Array(this.data.length+n.length);for(u.set(this.data,0),u.set(n,this.data.length),this.data=u;;){let l=ut(this.data);if(l===-1)return;if(l>0){let f=s.decode(this.data.slice(0,l)),p;try{p=JSON.parse(f)}catch{throw new Error("could not parse change JSON")}let{last_seq:g,id:v,changes:m,deleted:b}=p;g?e.lastSeq=g:(e.numberOfChanges++,a.enqueue({id:v,revs:m,deleted:b}))}this.data=this.data.slice(l+1)}},data:new Uint8Array(0),startParsed:!1},{highWaterMark:1024*1024*8},{highWaterMark:1024})}},be=class extends TransformStream{constructor(e){super({async transform(s,n){let a={};for(let{id:f,revs:p}of s)a[f]=p.map(({rev:g})=>g);let l=await(await e.revsDiff(a)).json();for(let f in l){if(!(p in l[f]))throw new Error("missing `missing` property in revsDiff response");let{missing:p}=l[f],g=p.map(v=>({rev:v}));g.length>0&&n.enqueue({id:f,revs:g})}}})}},Se=class extends TransformStream{constructor(e,s){s.docsRead=0;let n=new TextDecoder,a=async u=>{if(u.length===0)return;let{headers:l,data:f}=u.shift(),p=l["Content-Type"];if(!p)throw new Error("missing Content-Type header for first part");if(p!=="application/json")throw new Error(`wrong Content-Type header for first part '${p}', must be application/json`);let g=n.decode(f),v;try{v=JSON.parse(g)}catch{throw new Error("Error parsing doc JSON")}for(let{headers:m,data:b}of u){let y=m["Content-Disposition"];if(!y)throw new Error("attachment with missing Content-Disposition header");let[S,_]=y.match(/filename="([^"]+)"/);if(!_)throw new Error(`missing filename in Content-Disposition header '${y}'`);if(!(_ in v._attachments))throw new Error(`missing filename '${_}' in docs attachments stub`);let w=m["Content-Type"];if(!w)throw new Error("missing Content-Type header");let d=new Blob([b],{type:w}),c=m["Content-Encoding"];if(c==="gzip")v._attachments[_].data=await Ie(d,w),delete v._attachments[_].follows,delete v._attachments[_].encoding,delete v._attachments[_].encoded_length;else{if(c)throw new Error(`unsupported Content-Encoding '${c}'. Must be 'gzip'`);v._attachments[_].data=d,delete v._attachments[_].follows}}return v};super({async transform(u,l){if(u.length===0)return;let f=[],p={};for(let t of u){let{id:r,revs:i}=t;p[r]=t;for(let{rev:o}of i)f.push({id:r,rev:o})}if(f.length===0)throw new Error("received messages with empty revs");let g=await e.bulkGet(f),v=g.headers.get("Content-Type"),m=new Y(v),b=g.body.getReader(),y,S={},_=async(t,r)=>{let i=await a(t);if(i){let{_id:o,_rev:T}=i;if(S[o]=S[o]||{},S[o][T]=i,r||y&&y!==o){if(!(o in p))throw new Error(`received a doc which was not requested: '${o}'`);let D=p[o],R=[];for(let E of D.revs)if(E.rev in S[o]){let x=S[o][E.rev];R.push({rev:E,doc:x})}else console.warn(`could not fetch rev '${E.rev}' for doc '${o}'`);l.enqueue({...D,revs:R}),s.docsRead++}y=o}},w=!1,d=[],c=null;do{let{done:t,value:r}=await b.read(),i=m.read(r);for(let o of i)o.boundary?c&&c!==o.boundary?(_(d),d=[o],c=null):(d.push(o),c=o.boundary):(_(d),d=[],c=null,_([o]));w=t}while(!w);_(d,!0)}},{highWaterMark:8},{highWaterMark:1024*4})}},Re=class extends WritableStream{constructor(e,s={}){s.docsWritten=0,super({async write(n){let a=n.reduce((l,{revs:f})=>l.concat(f.map(({doc:p})=>p)),[]),u=await e.bulkDocs(a);s.docsWritten+=n.length}})}},k=class extends P{constructor(e){super(),this.adapter=e}async getInfo(){let[{uuid:e},{update_seq:s}]=await Promise.all([this.adapter.getServerInfo(),this.adapter.getInfo()]);return{uuid:e,updateSeq:s}}async getLog(e){let s=`_local/${e}`,n;try{n=await(await this.adapter.getDoc(s)).json()}catch{n={_id:s}}return n}async saveLog(e){return(await this.adapter.saveDoc(e)).json()}getChanges(e,{limit:s}={},n={}){let a=new ye(this.adapter,{since:e,limit:s}),u=new _e(n);return a.pipeThrough(u)}getDiff(){return new be(this.adapter)}getRevs(e={}){return new Se(this.adapter,e)}saveRevs(e={}){return new Re(this.adapter,e)}};var oe=class extends I{constructor({url:e,headers:s}){super(),this.adapter=new Z({url:e,headers:s}),this.replicator=new k(this.adapter)}async getDoc(e){return(await this.adapter.getDoc(e)).json()}async saveDoc(e){let s=await this.adapter.saveDoc(e);return this.dispatchEvent(new Event("change")),s.json()}async deleteDoc(e){let s=await this.adapter.deleteDoc(e);return this.dispatchEvent(new Event("change")),s.json()}};var ee=class extends P{constructor(e){super(),this.database=e}getInfo(){let{uuid:e,updateSeq:s}=this.database,n={uuid:e,updateSeq:s};return console.log("getInfo",n),n}getLog(e){return console.log("getLog %s",e),{_id:`_local/${e}`}}saveLog(e){return console.log("saveLog",e),{rev:"1-fake-log-rev"}}getChanges(e,{limit:s}={},n={}){let a=this.database;return new ReadableStream({start(u){console.log("getting changes since %s",e),u.enqueue({id:"changed-fake-doc-a",revs:[{rev:"1-change-a"},{rev:"2-change-a"}]}),u.enqueue({id:"changed-fake-doc-b",revs:[{rev:"1-change-b"}]}),n.numberOfChanges=2,n.lastSeq=a.updateSeq,u.close()}})}getDiff(){return new TransformStream({transform(e,s){console.log("geting diff",e);for(let n of e)s.enqueue(n)}})}getRevs(e={}){return e.docsRead=0,new TransformStream({transform(s,n){console.log("getting revs",s);for(let{id:a,revs:u}of s)n.enqueue({id:a,revs:u.map(({rev:l})=>({rev:l,doc:{_id:a,_rev:l,foo:"bar"}}))});e.docsRead+=s.length}})}saveRevs(e={}){e.docsWritten=0;let s=this.database;return new WritableStream({write(n){console.log("saving revs",n),e.docsWritten+=n.length,s.updateSeq+=n.length}})}};var ae=class extends I{constructor(){super(),this.uuid=`fake-uuid-${Math.round(Math.random()*100)}`,this.updateSeq=Math.round(Math.random()*100),this.replicator=new ee(this)}init(){}destroy(){}getDoc(e){throw new Error(`fake doc '${e}' not found`)}saveDoc(e){return console.log("saving doc",e),this.updateSeq++,{rev:"1-fake-doc-rev"}}};export{ae as FakeDatabase,oe as HttpMultipartDatabase,se as IndexedDbFlatDatabase,ne as IndexedDbNormalizedDatabase};
